---
title: "è¨€èªç·´ç¿’ï¼šç”Ÿå¹´æœˆæ—¥ã‹ã‚‰å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’ç®—å‡º" # è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«
emoji: "ğŸšŒ" # ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹çµµæ–‡å­—ï¼ˆ1æ–‡å­—ã ã‘ï¼‰
type: "idea" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: ["vba", "java", "python", "php", "c"] # ã‚¿ã‚°ã€‚["javascript", "excel"]ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
published: true # å…¬é–‹è¨­å®šï¼ˆfalseã«ã™ã‚‹ã¨ä¸‹æ›¸ãï¼‰
---

## ã¯ã˜ã‚ã«

æœ¬è¨˜äº‹ã¯ã€ä¸‹è¨˜è¨˜äº‹ã§è¡Œã£ãŸå†…å®¹ã‚’**ä»–ã®è¨€èªç­‰ã§å®Ÿè£…**ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã«ã—ã¦ãŠã‚Šã¾ã™ã€‚

https://zenn.dev/nonaka101/articles/calculate-age-and-days

æœ¬è¨˜äº‹ã§ã¯ JavaScript ã«åŠ ãˆã€ä¸‹è¨˜ã®è¨€èªç­‰ã§å®Ÿè£…ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

- [Excel é–¢æ•°](#excel)
- [VBA](#vba)
- [PHP](#php)
- [Python](#python)
- [Java](#java)
- [C è¨€èª](#cè¨€èª)

:::details ã‚¿ã‚¤ãƒˆãƒ«ã€Œè¨€èªç·´ç¿’ã€ã«ã¤ã„ã¦

ã‚¿ã‚¤ãƒˆãƒ«ã®ã€Œè¨€èªç·´ç¿’ã€ã¯ã€ãƒ•ãƒ©ãƒ³ã‚¹ã®å°èª¬å®¶ ãƒ¬ãƒ¼ãƒ¢ãƒ³ãƒ»ã‚¯ãƒãƒ¼ã®è‘—æ›¸ã€æ–‡ä½“ç·´ç¿’ã€ã«å€£ã£ãŸã‚‚ã®ã§ã™ã€‚

ã“ã®æœ¬ã¯ã€ç«¯çš„ã«è¨€ã£ã¦ã—ã¾ãˆã°ã€Œãƒã‚¹ã§å£è«–ã—ã¦ã„ã‚‹ç”·ã‚’è¦‹ã‹ã‘ã€å¾Œã§é§…å‰ã«è¡Œã£ãŸéš›ã« ãã®ç”·ãŒåŠ©è¨€ã‚’å—ã‘ã¦ã„ã‚‹ã®ã‚’è¦‹ã‹ã‘ãŸã€ã¨ã„ã†è©±ã‚’ã€99é€šã‚Šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§è¡¨ç¾ã—ãŸæ›¸ç±ã§ã™ã€‚

ã‚ã‚‹è¨€èªã§ä½œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚’åˆ¥è¨€èªã§è¡¨ç¾ã—ãŸå ´åˆã€ã¨ã„ã†æœ¬è¨˜äº‹ã®ä¸»æ—¨ã«ä¼¼ã¦ã„ãŸã®ã§ã€å‚è€ƒã«ã—ã¾ã—ãŸã€‚

:::

### ç›®æ¨™ã«ã¤ã„ã¦

æœ¬è¨˜äº‹ã§å–ã‚Šæ‰±ã£ã¦ã„ã‚‹å†…å®¹ã«ã¤ã„ã¦ã®æ¦‚è¦ã‚’ã€ã“ã“ã§èª¬æ˜ã—ã¾ã™ã€‚å¹´é½¢ã®è¨ˆç®—æ–¹æ³•ç­‰ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€[å‰è¨˜äº‹](https://zenn.dev/nonaka101/articles/calculate-age-and-days)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### åŸºæœ¬çš„ãªæ¡ä»¶ã®è¨­å®š

æœ¬è¨˜äº‹ã§ã¯æ§˜ã€…ãªè¨€èªç­‰ã§ã®å®Ÿè£…ã‚’è¡Œã£ã¦ã„ãã¾ã™ãŒã€ãã®åœŸå°ã¨ãªã‚‹ã‚‚ã®ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚

- å¼•æ•°ã¨ã—ã¦ã€å¿…é ˆè¦ç´  1 ã¤ ä»»æ„è¦ç´  1 ã¤ã‚’å—ã‘å–ã‚‹
  1. å¿…é ˆï¼šç”Ÿå¹´æœˆæ—¥ã‚’è¡¨ã™ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ`yyyy-MM-dd` å½¢å¼ï¼‰
  2. ä»»æ„ï¼šè¨ˆç®—åŸºæº–æ—¥ã¨ãªã‚‹æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ ä»Šæ—¥ï¼‰
- ä¸Šè¿°ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«ã€æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’ç®—å‡ºã™ã‚‹

#### æ¤œè¨¼ã«ã¤ã„ã¦

æ—¥ä»˜ã«é–¢ã™ã‚‹è¨ˆç®—ã§ã‚ã‚‹ãŸã‚ã€é–å¹´ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã€ä¸‹è¨˜ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ãŸå ´åˆã«åŒã˜çµæœã«ãªã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

:::details ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿

| ç”Ÿå¹´æœˆæ—¥ | è¨ˆç®—åŸºæº–æ—¥ | æº€å¹´é½¢ | çµŒéæ—¥æ•° |
| --- | --- | ---: | ---: |
| 1999-02-28 | 2023-02-28 | 24  | 0  |
| 1999-03-01 | 2023-02-28 | 23  | 364  |
| 2000-02-28 | 2023-02-28 | 23  | 0  |
| 2000-02-29 | 2023-02-28 | 22  | 364  |
| 2000-03-01 | 2023-02-28 | 22  | 364  |
| 1999-02-28 | 2023-03-01 | 24  | 1  |
| 1999-03-01 | 2023-03-01 | 24  | 0  |
| 2000-02-28 | 2023-03-01 | 23  | 1  |
| 2000-02-29 | 2023-03-01 | 23  | 0  |
| 2000-03-01 | 2023-03-01 | 23  | 0  |
| 1999-02-28 | 2024-02-28 | 25  | 0  |
| 1999-03-01 | 2024-02-28 | 24  | 364  |
| 2000-02-28 | 2024-02-28 | 24  | 0  |
| 2000-02-29 | 2024-02-28 | 23  | 364  |
| 2000-03-01 | 2024-02-28 | 23  | 364  |
| 1999-02-28 | 2024-02-29 | 25  | 1  |
| 1999-03-01 | 2024-02-29 | 24  | 365  |
| 2000-02-28 | 2024-02-29 | 24  | 1  |
| 2000-02-29 | 2024-02-29 | 24  | 0  |
| 2000-03-01 | 2024-02-29 | 23  | 365  |
| 1999-02-28 | 2024-03-01 | 25  | 2  |
| 1999-03-01 | 2024-03-01 | 25  | 0  |
| 2000-02-28 | 2024-03-01 | 24  | 2  |
| 2000-02-29 | 2024-03-01 | 24  | 1  |
| 2000-03-01 | 2024-03-01 | 24  | 0 |

:::

:::message

è¨˜äº‹ä½œæˆæ™‚ç‚¹ã§ã€Cè¨€èªä»¥å¤–ã¯ç¢ºèªãŒå–ã‚Œã¦ã„ã¾ã™ã€‚

:::

## JavaScript

ã¾ãšã¯ã€[å‰è¨˜äº‹](https://zenn.dev/nonaka101/articles/calculate-age-and-days)ã§ã‚‚æ‰±ã£ã¦ã„ã‚‹ JavaScript ã§ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ä»•çµ„ã¿ã«ã¤ã„ã¦ã¯ã€[å‰è¨˜äº‹](https://zenn.dev/nonaka101/articles/calculate-age-and-days)ã®æ–¹ã‚’å‚ç…§ãã ã•ã„ã€‚

### æº€å¹´é½¢ã®è¨ˆç®—ï¼ˆJavaScriptï¼‰

```javascript:æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°ï¼ˆJavaScriptï¼‰
/**
 * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰
 *
 * @param {date} dateBirth - ç”Ÿå¹´æœˆæ—¥
 * @param {date} dateBase - è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
 * @returns {int} - æº€å¹´é½¢
 */
function calcAge(dateBirth, dateBase = new Date()){
  // å‹ãƒã‚§ãƒƒã‚¯
  if(!(dateBirth instanceof Date && dateBase instanceof Date)) throw new Error('å¼•æ•°ã¯ Date å‹ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“');

  const age = dateBase.getFullYear() - dateBirth.getFullYear();

  // åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆè¨ˆç®—åŸºæº–å¹´ï¼‰ã¯ã€èª•ç”Ÿæ—¥ã®å‰æ—¥24æ™‚
  const timeBoundaryForAging = new Date(
    dateBase.getFullYear(),
    dateBirth.getMonth(),
    dateBirth.getDate() - 1,
    24
  );

  // æº€å¹´é½¢ã¯ã€åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ ã¾ã è¶Šãˆã¦ã„ãªã„å ´åˆã€ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦è¿”ã™
  if(timeBoundaryForAging > dateBase){
    return age - 1;
  } else {
    return age;
  }
}
```

### æœŸé–“å†…ã®æ—¥æ•°è¨ˆç®—ï¼ˆJavaScriptï¼‰

```javascript:æœŸé–“ã®æ—¥æ•°ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°ï¼ˆJavaScriptï¼‰
/**
 * ï¼’ã¤ã®æ—¥ä»˜é–“ã«ã‚ã‚‹æ—¥æ•°ï¼ˆçµ¶å¯¾å€¤ï¼‰ã‚’ç®—å‡º
 *
 * @param {date} date1 - æ—¥ä»˜ï¼‘
 * @param {date} date2 - æ—¥ä»˜ï¼’
 * @returns {int} æœŸé–“å†…ã®æ—¥æ•°ï¼ˆä½™å‰°ã®æ™‚é–“ã¯åˆ‡ã‚Šæ¨ã¦ï¼‰
 */
function dateDiff(date1, date2) {
  // å‹ãƒã‚§ãƒƒã‚¯
  if(!(date1 instanceof Date && date2 instanceof Date)) throw new Error('å¼•æ•°ã¯ Date å‹ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“');

  // ãƒŸãƒªç§’å˜ä½ã§ã®æœŸé–“ã‚’æ±‚ã‚ã€æ—¥æ•°å˜ä½ã«ã—ã¦è¿”ã™
  const ms = Math.abs(date1.getTime() - date2.getTime());
  return Math.floor(ms / (1000 * 60 * 60 * 24));
}
```

### æ—¥ä»˜æ–‡å­—åˆ—ã®åˆ¤å®šï¼ˆJavaScriptï¼‰

```javascript:æ—¥ä»˜æ–‡å­—åˆ—ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°ï¼ˆJavaScriptï¼‰
/**
 * å¹´æœˆæ—¥ã‚’è¡¨ã™æ–‡å­—åˆ—ãŒã€é©æ­£ã‹ã‚’åˆ¤æ–­
 *
 * @param {string} dateString - 'yyyy-MM-dd' å½¢å¼ã®æ–‡å­—åˆ—
 * @returns {boolean} å­˜åœ¨ã—ã†ã‚‹æ—¥ä»˜ã‹ã®åˆ¤å®š
 */
function isDateFormat(dateString) {
  // æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆyyyy-MM-ddï¼‰
  const dateFormatRegex = /^\d{4}-\d{2}-\d{2}$/
  if (!dateString.match(dateFormatRegex)) return false;

  // ç°¡æ˜“çš„ãªæœˆæ—¥ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæœˆã®ç¯„å›²ã¯1ã€œ12ã‹ã€æ—¥ã®ç¯„å›²ã¯1ã€œ31ã‹ï¼‰
  const [year, month, day] = dateString.split('-').map(Number);
  if(
    !(month >= 1 && month <= 12) ||
    !(day >= 1 && day <= 31)
  ) return false;

  // date å‹ã«ã‚ˆã‚‹å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆå…¥åŠ›å€¤ãŒ `2/31` ã¨ã„ã£ãŸå­˜åœ¨ã—ãªã„æ—¥ä»˜ã ã£ãŸã‚Šã€é–æ—¥ã«ã‚ˆã‚Šå®Ÿéš›ã®æ—¥ä»˜ã¨ã‚ºãƒ¬ã¦ãªã„ã‹ï¼‰
  const date = new Date(year, month - 1, day);
  if (
    date.getFullYear() !== year ||
    date.getMonth() + 1 !== month ||
    date.getDate() !== day
  ) return false;

  return true;
}
```

### æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã®ç®—å‡ºï¼ˆJavaScriptï¼‰

[å‰è¨˜äº‹](https://zenn.dev/nonaka101/articles/calculate-age-and-days)ã§ã¯ã€é–¢æ•°åŒ–ã—ã¦ã„ãŸã®ã¯ã“ã“ã¾ã§ã§ã—ãŸã€‚æœ¬è¨˜äº‹ã§ã¯ã“ã‚Œã«ãƒ—ãƒ©ã‚¹ã—ã€**æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’å‡ºåŠ›ã™ã‚‹å‡¦ç†**ã‚’é–¢æ•°ã¨ã—ã¦ç‹¬ç«‹ã•ã›ã¾ã™ã€‚

```javascript:ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’ç®—å‡ºã™ã‚‹é–¢æ•°ï¼ˆJavaScriptï¼‰
/**
 * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’è¨ˆç®—
 *
 * @param {string} textBirth - ç”Ÿå¹´æœˆæ—¥ï¼ˆyyyy-MM-ddå½¢å¼ï¼‰
 * @param {date} dateBase - è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
 */
function calcAgeAndDays(textBitrh, dateBase = new Date()){
  if(isDateFormat(textBitrh)) {
    const [year, month, day] = textBitrh.split('-').map(Number);
    const dateBirth = new Date(year, month - 1, day);

    const age = calcAge(dateBirth, dateBase);

    // ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
    const timeAging = new Date(
      dateBirth.getFullYear() + age,
      dateBirth.getMonth(),
      dateBirth.getDate() - 1,
      24
    );

    const days = dateDiff(timeAging, dateBase);

    console.log(`å¹´é½¢ã¯ ${age} æ­³ã€çµŒéæ—¥æ•°ã¯ ${days} æ—¥ã§ã™`);
  }
}
```

ã“ã‚Œã§ JavaScript ã«ã‚ˆã‚‹å®Ÿè£…ã¯å®Œæˆã¨ãªã‚Šã¾ã™ã€‚

## Excel

ã“ã“ã§ã¯ã€ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒï¼‰Excel ã®é–¢æ•°ã‚’ä½¿ã£ãŸå®Ÿè£…ã‚’è€ƒãˆã¦ã„ãã¾ã™ã€‚æœ€çµ‚çš„ãªå½¢ã¯ä¸‹å›³ã®ã‚ˆã†ã«ãªã‚Šã€`C`åˆ— åŠã³ `D`åˆ— ã«é–¢æ•°ã‚’ä»•è¾¼ã‚“ã§ã„ã¾ã™ã€‚

![æœ€åˆã«æ²è¼‰ã—ã¦ã„ãŸãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’Excelã§è¡¨ç¾ã—ãŸã‚‚ã®](/images/articles/exercise_in_language__calculate_age/calc_age-01.png)

| ã‚»ãƒ« | å¼ |
| --- | --- |
| `C2` | `=LET(Age, YEAR(B2)-YEAR(A2), IF(B2>=DATE(YEAR(B2), MONTH(A2), DAY(A2)-1)+1, Age, Age-1))` |
| `D2` | `=DATEDIF(DATE(YEAR(A2)+C2, MONTH(A2), DAY(A2)-1)+1, B2, "D")` |

:::message

ä¸Šè¨˜æ•°å¼ã¯ã€å‡¦ç†é€Ÿåº¦ã‚ˆã‚Š**æ‰‹ç¶šãã®èª¬æ˜æ€§**ã‚’é‡è¦–ã—ãŸã‚‚ã®ã§ã™ã€‚

ä¾‹ãˆã° `C2` ã‚»ãƒ«ã®å¼ã§ã™ãŒã€å‡¦ç†é€Ÿåº¦ã‚’é‡è¦–ã™ã‚‹å ´åˆ ä¾‹ãˆã°ç°¡ç•¥åŒ–ã™ã‚‹ãŸã‚ã« `DATEDIF()` é–¢æ•°ã‚’ä½¿ã†ãªã©ã®æ–¹æ³•ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

:::

### è¨ˆç®—å¼ã«ã¤ã„ã¦

`C`åˆ—, `D`åˆ—ã«ã‚ã‚‹é–¢æ•°ã¯ã€è¤‡æ•°ã®è¨ˆç®—ã‚’ã¾ã¨ã‚ãŸå½¢ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€ãã‚Œãã‚Œã‚’åˆ†è§£ã—ã¤ã¤èª¬æ˜ã‚’ã—ã¦ã„ãã¾ã™ã€‚

#### C2ã‚»ãƒ«ï¼šæº€å¹´é½¢è¨ˆç®—ã«ã¤ã„ã¦

`=LET(Age, YEAR(B2)-YEAR(A2), IF(B2>=DATE(YEAR(B2), MONTH(A2), DAY(A2)-1)+1, Age, Age-1))`

ã“ã®è¨ˆç®—å¼ã¯ã€ä¸‹è¨˜ã®è¦ç´ ã‚’çµ„ã¿åˆã‚ã›ãŸã‚‚ã®ã§ã™ã€‚

1. ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€è¨ˆç®—åŸºæº–å¹´ã®èª•ç”Ÿæ—¥ã‚’ç”Ÿæˆ
2. è¨ˆç®—åŸºæº–æ—¥ã¨ã®å¤§å°æ¯”è¼ƒã‚’ã—ã€å‡¦ç†ã‚’åˆ†å²
3. åˆ†å²å†…å®¹ã«å¾“ã£ã¦ã€æº€å¹´é½¢ã®è¨ˆç®—

ã“ã‚Œã‚‰ã‚’ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«è¦‹ã¦ã„ãã¾ã™ã€‚

##### è¨ˆç®—åŸºæº–å¹´ã®èª•ç”Ÿæ—¥ã‚’ç”Ÿæˆ

`DATE(YEAR(B2), MONTH(A2), DAY(A2)-1)+1` ã®éƒ¨åˆ†ãŒã€è¨ˆç®—åŸºæº–å¹´ã®èª•ç”Ÿæ—¥ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆã«ã¯ `DATE(å¹´, æœˆ, æ—¥)` é–¢æ•°ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

- ã€Œå¹´ã€ã®å¼•æ•°éƒ¨ã«ã¯ã€`B2`ã‚»ãƒ«ï¼ˆâ‰’ è¨ˆç®—åŸºæº–æ—¥ï¼‰ã‹ã‚‰ `YEAR(æ—¥ä»˜)` é–¢æ•°ã§å¹´æ•°ã ã‘ã‚’å–ã‚Šå‡ºã—ã¦ã„ã¾ã™
- ã€Œæœˆã€ã®å¼•æ•°éƒ¨ã«ã¯ã€`A2`ã‚»ãƒ«ï¼ˆâ‰’ ç”Ÿå¹´æœˆæ—¥ï¼‰ã‹ã‚‰ `MONTH(æ—¥ä»˜)` é–¢æ•°ã§æœˆæ•°ã ã‘ã‚’å–ã‚Šå‡ºã—ã¦ã„ã¾ã™
- ã€Œæ—¥ã€ã®å¼•æ•°éƒ¨ã«ã¯ã€`A2`ã‚»ãƒ«ã‹ã‚‰ `DAY(æ—¥ä»˜)` é–¢æ•°ã§æ—¥æ•°ã‚’å–ã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚ã“ã®æ™‚ `-1` ã‚’åŠ ãˆã‚‹ã“ã¨ã§ã€å‰æ—¥ã¨ãªã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã¦ã„ã¾ã™

`DATE()` é–¢æ•°ã«ã‚ˆã‚Šã€è¨ˆç®—åŸºæº–å¹´ã®èª•ç”Ÿæ—¥**å‰æ—¥**ã®ãƒ‡ãƒ¼ã‚¿ãŒç”Ÿæˆã§ãã¾ã—ãŸã€‚å¼ã§ã¯æœ€å¾Œã€ã“ã®ãƒ‡ãƒ¼ã‚¿ã« `+1` ã‚’åŠ ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯**èª•ç”Ÿæ—¥å‰æ—¥ã®24æ™‚**ã‚’è¡¨ã™ãŸã‚ã®å‡¦ç†ã§ã™ã€‚

::::message

Excelä¸Šã§æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã¯ `2000/01/01` ã¨ã„ã£ãŸã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã¯æ•°å€¤ï¼ˆã‚·ãƒªã‚¢ãƒ«å€¤ï¼‰ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚

å†…éƒ¨çš„ã«ã¯ 1900 å¹´ 1 æœˆ 1 æ—¥ã‚’ã€Œ1ã€ã¨ã—ã¦ãŠã‚Šã€ä¾‹ãˆã°å…ˆç¨‹ã® `2000/01/01` ã®å ´åˆã¯ `36526` ã¨ã„ã†å€¤ã«ãªã‚Šã¾ã™ã€‚æ•´æ•°éƒ¨ãŒæ—¥ä»˜ã€å°æ•°éƒ¨ãŒæ™‚é–“ã‚’è¡¨ã™ãŸã‚ã€`2000/01/02` ã¯ `36527`ã€`2000/01/02 12:00` ã¯ `36527.5` ã¨ãªã‚‹ã‚ã‘ã§ã™ã€‚

:::details VBAã§ã®ã‚·ãƒªã‚¢ãƒ«å€¤ç¢ºèª

ã“ã® Excel ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„ã¯ã€VBAå´ã«ã‚‚é©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸‹è¨˜ã¯ãã‚Œã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```vba:VBAã§ã®ã‚·ãƒªã‚¢ãƒ«å€¤ç¢ºèª
Dim d1 As Date
d1 = "2000-01-01"
Debug.Print CDbl(d1)  ' -> 36526

Dim d2 As Date
d2 = "2000-01-02"
Debug.Print CDbl(d2)  ' -> 36527

Dim d3 As Date
d3 = "2000-01-02 12:00"
Debug.Print CDbl(d3)  ' -> 36527.5
```

:::

::::

##### å¤§å°åˆ¤å®šã«ã‚ˆã‚‹åˆ†å²

`IF({æ¡ä»¶å¼}, {TRUEæ™‚ã®æŒ™å‹•}, {FALSEæ™‚ã®æŒ™å‹•})` ã®éƒ¨åˆ†ãŒã€å¤§å°åˆ¤å®šã«ã‚ˆã‚‹åˆ†å²ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚æ¡ä»¶å¼ã®éƒ¨åˆ†ã§ã€è¨ˆç®—åŸºæº–æ—¥ã§ã‚ã‚‹ `B2` ã‚»ãƒ«ã¨[å‰è¿°ã—ãŸè¨ˆç®—åŸºæº–å¹´ã®èª•ç”Ÿæ—¥](#è¨ˆç®—åŸºæº–å¹´ã®èª•ç”Ÿæ—¥ã‚’ç”Ÿæˆ)ã‚’æ¯”è¼ƒã—ã€ãã®çµæœã«ã‚ˆã‚Šå‡¦ç†ã‚’åˆ†å²ã•ã›ã¦ã„ã¾ã™ã€‚Excel ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã¯å®Ÿéš›ã«ã¯æ•°å€¤ï¼ˆã‚·ãƒªã‚¢ãƒ«å€¤ï¼‰ã§ã‚ã‚‹ãŸã‚ã€ã“ã®ã‚ˆã†ãªå¤§å°æ¯”è¼ƒãŒè¡Œãˆã‚‹ã‚ã‘ã§ã™ã€‚

- `B2` ã‚»ãƒ«ãŒå¤§ãã„ï¼ˆâ‰’ è¨ˆç®—åŸºæº–æ—¥ãŒèª•ç”Ÿæ—¥ã‚’è¶Šãˆã¦ã„ã‚‹ï¼‰å ´åˆã¯ã€ä¸¡è€…ã§å¹´æ•°ã‚’å¼•ã„ãŸå€¤ãŒæº€å¹´é½¢
- ãã†ã§ãªã„å ´åˆã¯ã€ä¸¡è€…ã§å¹´æ•°ã‚’å¼•ã `-1` ã‚’ã—ãŸå€¤ãŒæº€å¹´é½¢

##### æº€å¹´é½¢ã®è¨ˆç®—

`LET(Age, YEAR(B2)-YEAR(A2), {è¨ˆç®—å¼})` ã®éƒ¨åˆ†ãŒã€æº€å¹´é½¢ã®è¨ˆç®—ã‚’ç°¡ç•¥åŒ–ã—ãŸéƒ¨åˆ†ã§ã™ã€‚ã“ã“ã§ã¯ `LET(åå‰, è¨ˆç®—å†…å®¹, ã€Œåå‰ã€ã‚’ä½¿ã£ãŸè¨ˆç®—å¼)` é–¢æ•°ã‚’ä½¿ã†ã“ã¨ã§ã€å¼ã®ç°¡ç•¥åŒ–ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

`LET()` é–¢æ•°ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§è¨€ã†å¤‰æ•°ã®ã‚ˆã†ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚åŒã˜è¨ˆç®—å†…å®¹ã‚’ä½¿ã†å ´åˆã«éƒ½åº¦æ‰‹æ‰“ã¡ã§å…¥åŠ›ã—ã¦ã—ã¾ã†ã¨ã€åˆ†ã‹ã‚Šã¥ã‚‰ã„ã§ã™ã—ã€å¤‰æ›´æ™‚ã®ãƒŸã‚¹ã«ã‚‚ç¹‹ãŒã‚Šã¾ã™ã€‚ãã®ãŸã‚å¼ã«ç¹°ã‚Šè¿”ã—åˆ©ç”¨ã™ã‚‹è¨ˆç®—å†…å®¹ã¯ã€äº‹å‰ã«å…±æœ‰ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ã“ã“ã§ã¯æº€å¹´é½¢ã®è¨ˆç®—ï¼ˆ`YEAR(B2)-YEAR(A2)`ï¼‰ã‚’ `Age` ã¨ã„ã†åå‰ã§ç™»éŒ²ã—ã€`IF()` å†…ã§ã®åˆ†å²å‡¦ç†ï¼ˆãã®ã¾ã¾ä½¿ã†ã‹ã€ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ãŸå½¢ã§ä½¿ã†ã‹ï¼‰ã®éƒ¨åˆ†ã§åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

#### D2ã‚»ãƒ«ï¼šçµŒéæ—¥æ•°ã«ã¤ã„ã¦

`=DATEDIF(DATE(YEAR(A2)+C2, MONTH(A2), DAY(A2)-1)+1, B2, "D")`

ã“ã®è¨ˆç®—å¼ã¯ã€ä¸‹è¨˜ã®å†…å®¹ã‚’çµ„ã¿åˆã‚ã›ãŸã‚‚ã®ã§ã™ã€‚

1. æº€å¹´é½¢ã«ãªã£ãŸæ™‚ç‚¹ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
2. è¨ˆç®—åŸºæº–æ—¥ã¨ã®å·®åˆ†ã‚’ã€æ—¥æ•°æ›ç®—ã§è¨ˆç®—

ã“ã‚Œã‚‰ã‚’ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«è¦‹ã¦ã„ãã¾ã™ã€‚

##### æº€å¹´é½¢ã«ãªã£ãŸæ™‚ç‚¹ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ

`DATE(YEAR(A2)+C2, MONTH(A2), DAY(A2)-1)+1` ã®éƒ¨åˆ†ãŒã€æº€å¹´é½¢ã«ãªã£ãŸæ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ã—ã¾ã™ã€‚ã“ã‚Œã¯[è¨ˆç®—åŸºæº–å¹´ã®èª•ç”Ÿæ—¥ã‚’ç”Ÿæˆ](#è¨ˆç®—åŸºæº–å¹´ã®èª•ç”Ÿæ—¥ã‚’ç”Ÿæˆ)ã¨åŒæ§˜ã€`DATE()` é–¢æ•°ã‚’ä½¿ã£ã¦ä½œã£ã¦ã„ã¾ã™ã€‚

ã€Œå¹´ã€ã®å¼•æ•°ã«ã¤ã„ã¦ã¯ã€æº€å¹´é½¢ã‚’è¨ˆç®—ã—ãŸ `C2` ã‚»ãƒ«ãŒã‚ã‚‹ã®ã§ ã“ã‚Œã‚’ `A2` ã‚»ãƒ«ã®å¹´æ•°ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ç®—å‡ºã§ãã¾ã™ã€‚å¾Œã¯åŒã˜ã‚ˆã†ã«ã€å‰æ—¥ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã— ãã‚Œã« `+1` ã‚’åŠ ãˆã‚‹ã“ã¨ã§ã€Œèª•ç”Ÿæ—¥å‰æ—¥ã®24æ™‚ã€ã‚’è¡¨ã—ã¾ã™ã€‚

##### ä¸¡æ—¥ä»˜ã®å·®åˆ†ã‚’æ—¥æ•°æ›ç®—ã§ç®—å‡º

`DATEDIF({æº€å¹´é½¢ã«ãªã£ãŸæ—¥ä»˜}, B2, "D")` ã®éƒ¨åˆ†ãŒã€æ—¥æ•°æ›ç®—ã§ã®å·®åˆ†è¨ˆç®—ã‚’è¡¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ä»Šå¹´ã®èª•ç”Ÿæ—¥ã¨è¨ˆç®—åŸºæº–æ—¥ã¨ã®æ—¥æ•°ã‚’ã€`DATEDIF(æ—¥ä»˜A, æ—¥ä»˜B, è¨ˆç®—å˜ä½)` é–¢æ•°ã«ã‚ˆã£ã¦ç®—å‡ºã—ã¦ã„ã¾ã™ã€‚è¨ˆç®—å˜ä½ã¯ ä»Šå›ã¯æ—¥æ•°ã‚’è¡¨ã™ `D` ã‚’ä½¿ã£ã¦ã„ã¾ã™ï¼ˆä»–ã«ã‚‚å¹´æ•°ã‚’è¡¨ã™ `Y` ã‚„ã€æœˆæ•°ã‚’è¡¨ã™ `M` ã€å¹´æ•°ã‚’ç„¡è¦–ã—ãŸå½¢ã§ã®æ—¥æ•°ã‚’è¡¨ã™ `YD` ãªã©ã‚‚æŒ‡å®šå¯èƒ½ã§ã™ï¼‰

### è£œè¶³ï¼šDATEDIFé–¢æ•°ã§è¨ˆç®—ã—ãŸå ´åˆ

ã¡ãªã¿ã«ã€ã€Œä¸Šè¿°ã—ãŸæ‰‹ç¶šãã‚’è¸ã¾ãšã¨ã‚‚ã€ãã®ã¾ã¾ `DATEDIF` é–¢æ•°1ã¤ã§æ¸ˆã‚€ã®ã§ã¯ï¼Ÿã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚çŸ¥ã‚Œã¾ã›ã‚“ã€‚ä¸‹è¡¨ã¯ã€å…ˆç¨‹ã®è¡¨ãƒ‡ãƒ¼ã‚¿ã«åŠ ãˆã‚‹å½¢ã§ `DATEDIF` é–¢æ•°ã§ã®è¨ˆç®—çµæœã‚’è¼‰ã›ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚å…ˆç¨‹ã¨åŒã˜ã‚ˆã†ã«ã€2è¡Œç›®ã®æ•°å¼ã‚‚è¼‰ã›ã¦ãŠã‚Šã¾ã™ã€‚

![ä¸Šå›³ã®ãƒ‡ãƒ¼ã‚¿ã«DATEDIFé–¢æ•°ã‚’ä½¿ã£ãŸã‚‚ã®ã‚’ä»˜ã‘åŠ ãˆãŸã‚‚ã®ã€ã„ãã¤ã‹è¨ˆç®—çµæœãŒé•ã£ã¦ã„ã‚‹](/images/articles/exercise_in_language__calculate_age/calc_age-02.png)

| ã‚»ãƒ« | å¼ |
| --- | --- |
| `E2` | `=DATEDIF(A2,B2,"Y")` |
| `F2` | `=DATEDIF(A2,B2,"YD")` |

æº€å¹´é½¢è¨ˆç®—ã«é–¢ã—ã¦ã¯ `DATEDIF()` ã¯åŒã˜è¨ˆç®—çµæœã‚’å‡ºã—ã¦ã„ã¾ã™ã€‚ãªã®ã§å‡¦ç†åŠ¹ç‡ã‚’å„ªå…ˆã™ã‚‹å ´åˆã¯ã“ã¡ã‚‰ã‚’ä½¿ã£ãŸã»ã†ãŒã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ä¸€æ–¹ã§çµŒéæ—¥æ•°ã«ã¤ã„ã¦ã¯ã€5 è¡Œç›®ã‚„ 15 è¡Œç›®ã«ã‚ã‚‹ã‚ˆã†ã«é•ã†æŒ™å‹•ã‚’ã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚ã“ã‚Œã¯ `DATEDIF()` é–¢æ•°ã§ç®—å‡ºã™ã‚‹éš›ã®èµ·ç®—æ—¥ãŒã“ã¡ã‚‰ã®æƒ³å®šã¨é•ã£ã¦ãŠã‚Šã€é–æ—¥ã«å¯¾å¿œã§ãã¦ã„ãªã„ã“ã¨ãŒåŸå› ã®ã‚ˆã†ã§ã™ã€‚

`DATEDIF()` ã¯å…ƒã€…[Lotusã¨ã®äº’æ›æ€§ã®ãŸã‚ã«ç”¨æ„ã•ã‚ŒãŸé–¢æ•°](https://support.microsoft.com/ja-jp/office/datedif-%E9%96%A2%E6%95%B0-25dba1a4-2812-480b-84dd-8b32a451b35c)ã§ã‚ã‚Šã€éå…¬å¼çš„ãªä½ç½®ã¥ã‘ã¨ãªã£ã¦ã„ã¾ã™ï¼ˆã€Œé–¢æ•°ã€ã‚¿ãƒ–ã«ã‚ã‚‹ä¸€è¦§ã«ã¯è¡¨ç¤ºã•ã‚Œãªã„ï¼‰  
ãã®ãŸã‚ã€`DATEDIF()` ã®ä½¿ç”¨ã¯æ¥µåŠ›é¿ã‘ã‚‹ã¹ããªã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

## VBA

æ¬¡ã« VBA ä¸Šã§ã®å®Ÿè£…ã‚’è¡Œã£ã¦ã„ãã¾ã™ã€‚

:::message

ãªãŠã€VBA ã§ã¯ `DateDiff()` [é–¢æ•°ãŒãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹](https://learn.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/datediff-function)ãŸã‚ã€JavaScript ã«ã‚ã£ãŸ `dateDiff()` é–¢æ•°ã‚’è‡ªä½œã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

:::

### æº€å¹´é½¢ã®è¨ˆç®—ï¼ˆVBAï¼‰

æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•° `CalcAge()` ã®ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚

```vba:æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°ï¼ˆVBAï¼‰
' ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰
'
' å¼•æ•° dateBirth As Date - ç”Ÿå¹´æœˆæ—¥
' å¼•æ•° (Optional) dateBase As Date - è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
' è¿”ã‚Šå€¤ Integer - æº€å¹´é½¢
'
Function CalcAge(dateBirth As Date, Optional dateBase As Date = 0) As Integer
  ' å¼•æ•°ãƒã‚§ãƒƒã‚¯
  If IsDate(dateBirth) = False Then
    Err.Raise vbObjectError + 1, , "å¼•æ•°ã¯Dateå‹ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“"
  End If

  Dim dateCalc As Date
  If (IsDate(dateBase) = False) Or (dateBase = 0) Then
    dateCalc = Now
  Else
    dateCalc = dateBase
  End If

  Dim age As Integer
  age = Year(dateCalc) - Year(dateBirth)

  ' åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆè¨ˆç®—åŸºæº–å¹´ï¼‰ã¯ã€èª•ç”Ÿæ—¥ã®å‰æ—¥24æ™‚
  Dim timeBoundaryForAging As Date
  timeBoundaryForAging = DateSerial(Year(dateCalc), Month(dateBirth), Day(dateBirth) - 1) + TimeSerial(24, 0, 0)

  ' æº€å¹´é½¢ã¯ã€åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ ã¾ã è¶Šãˆã¦ã„ãªã„å ´åˆã€ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦è¿”ã™
  If timeBoundaryForAging > dateCalc Then
    CalcAge = age - 1
  Else
    CalcAge = age
  End If
End Function
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ç‰¹å¾´çš„ãªã®ã¯ã€ä¸‹è¨˜ã®éƒ¨åˆ†ã§ã™ã€‚

- `Function` ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã§ã®åˆæœŸå€¤ã«æŒ‡å®šã§ãã‚‹ã®ã¯**ä»»æ„ã®å®šæ•°**ï¼ˆã¾ãŸã¯å®šæ•°å¼ï¼‰ã€ãªã®ã§ä»Šæ—¥ã®æ—¥ä»˜ã‚’æŒ‡å®šã™ã‚‹ã«ã¯ãƒ¯ãƒ³ã‚¯ãƒƒã‚·ãƒ§ãƒ³å¿…è¦
- `Date` å‹ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€å®Ÿéš›ã«ã¯ Excel åŒæ§˜ã‚·ãƒªã‚¢ãƒ«å€¤ã§ã®ç®¡ç†
- `Err.Raise` ã‚„ `Now` ãªã©ã€ä¸€éƒ¨ã®é–¢æ•°ã§ã¯ä»–ã¨é•ã£ãŸæ›¸ãæ–¹ã‚’ã™ã‚‹

æ—¥ä»˜ç”Ÿæˆã®é–¢æ•° `DateSerial(å¹´, æœˆ, æ—¥)` ã§èª•ç”Ÿæ—¥å‰æ—¥ã‚’ä½œã‚Šã€æ™‚é–“ç”Ÿæˆã®é–¢æ•° `TimeSerial(æ™‚, åˆ†, ç§’)` ã§ ã€Œ24 æ™‚é–“ã€ã‚’ç”Ÿæˆã€ä¸¡è€…ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€Œèª•ç”Ÿæ—¥å‰æ—¥ã® 24 æ™‚ã€ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚

#### Functionãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£

VBA ã§ã®é–¢æ•°ã¯ã€`Function é–¢æ•°å(å¼•æ•°) As ãƒ‡ãƒ¼ã‚¿å‹` ã¨ã„ã£ãŸå½¢ã§å®šç¾©ã—ã¾ã™ã€‚ã“ã®æ™‚ å¼•æ•°ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã™ã‚‹å ´åˆã¯ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ `Optional` ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

JavaScript ã§ã¯ã€å¼•æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦ `new Date()` ã§æ–°è¦ç”Ÿæˆã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ä¸€æ–¹ã§ VBA ã§ä¼¼ãŸã‚ˆã†ãªã“ã¨ã‚’ã™ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ä¸‹å›³ã¯ ä»Šæ—¥ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ `Date` é–¢æ•°ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«è¨­å®šã—ãŸã‚‚ã®ã§ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚

![å¼•æ•°ã«ã‚ã‚‹ Dateé–¢æ•°ã«ãƒãƒ¼ã‚«ãƒ¼ãŒå¼•ã‹ã‚Œã€ã€Œå®šæ•°å¼ãŒå¿…è¦ã§ã™ã€ã¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹](/images/articles/exercise_in_language__calculate_age/calc_age-04.png)

ãã®ãŸã‚åˆæœŸå€¤ã¯ 0 ã¨ã—ã¦ãŠãã€é–¢æ•°å†…ã§ `If` åˆ†å²ã‚’è¨­ã‘ã¦ä¸­èº«ã‚’ç¢ºèªã€é©æ­£ãªå½¢ã«ãªã‚‹ã‚ˆã†ã«å‡¦ç†ã—ã¦ã„ã¾ã™ã€‚

#### Dateå‹ã®å¤‰æ•°ã«ã¤ã„ã¦

[Excelã§ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„](#è¨ˆç®—åŸºæº–å¹´ã®èª•ç”Ÿæ—¥ã‚’ç”Ÿæˆ)ã§èª¬æ˜ã—ã¾ã—ãŸãŒã€Excelä¸Šã§ã®æ—¥ä»˜ã¯ã€å®Ÿéš›ã«ã¯ã‚·ãƒªã‚¢ãƒ«å€¤ã«ã‚ˆã‚‹ç®¡ç†ã¨ãªã£ã¦ã„ã¾ã™ã€‚

ãã®ãŸã‚ã€å­˜åœ¨ã—ãªã„æ—¥ä»˜ï¼ˆé–å¹´ã§ãªã„é–æ—¥ãªã©ï¼‰ã‚’æ–‡å­—åˆ—å½¢å¼ã‹ã‚‰ `Date` å‹ã«ç›´æ¥ä»£å…¥ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

![æ—¥ä»˜å‹ã®ã‚¨ãƒ©ãƒ¼ã€DateSerialé–¢æ•°ã§ã¯èª¿æ•´ã•ã‚Œã‚‹ãŒã€ç›´æ¥æ—¥ä»˜æ–‡å­—åˆ—ã‹ã‚‰ã®ä»£å…¥ã ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹](/images/articles/exercise_in_language__calculate_age/calc_age-06.png)
*`DateSerial` ã«ã‚ˆã‚‹æ—¥ä»˜ç”Ÿæˆã¯å•é¡Œãªãã€æ—¥ä»˜æ–‡å­—åˆ—ã‹ã‚‰ã®ç”Ÿæˆã§ã‚¨ãƒ©ãƒ¼ã¨ãªã£ã¦ã„ã‚‹*

[MS Learn](https://learn.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/dateserial-function)ã«ã‚ˆã‚‹ã¨ã€`DateSerial()` ã«ã‚ˆã‚‹æ—¥ä»˜ç”Ÿæˆã§ã¯ã€å­˜åœ¨ã—ãªã„ã‚±ãƒ¼ã‚¹ã¯ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆï¼ˆã‚ã‚‹ã„ã¯ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆï¼‰å‡¦ç†ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚ã“ã®æŒ™å‹•ã¯ã€å¾Œè¿°ã®æ—¥ä»˜æ–‡å­—åˆ—ã®åˆ¤å®šã«åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

```vba:å­˜åœ¨ã—ãªã„æ—¥ä»˜ã§ã‚‚DateSerialé–¢æ•°ã‚’ä½¿ãˆã°èª¿æ•´ã•ã‚Œã‚‹
Debug.Print DateSerial(2023, 2, 29) ' -> 2023/03/01
Debug.Print DateSerial(2023, 13, 40) ' -> 2024/02/09
```

`isDate()` é–¢æ•°ã§ã®ãƒã‚§ãƒƒã‚¯ã¯ã€æ–‡å­—åˆ—ã®å½¢ãŒå³æ ¼ã«æ±ºã¾ã£ã¦ã„ãªã„å ´åˆã¯ ã‚ã¾ã‚Šæ¨å¥¨ã•ã‚Œã¾ã›ã‚“ã€‚ã¨ã„ã†ã®ã‚‚ã€ã“ã®é–¢æ•°ã¯æ—¥ä»˜æ–‡å­—åˆ—ã‚’çµæ§‹åºƒã„å½¢ã§è§£é‡ˆã—ã¦ã„ã‚‹ã‚ˆã†ã ã‹ã‚‰ã§ã™ã€‚`isDate("2/29")`, `isDate("2/30")` ã¯ã€ã©ã¡ã‚‰ã‚‚ `true` ã‚’è¿”ã—ã¾ã™ã€‚ã“ã‚Œã¯èª¿ã¹ã¦ã¿ã‚‹ã¨ `2029-02-01`, `2030-02-01` ã¨è§£é‡ˆã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

https://learn.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/isdate-function

### æ—¥ä»˜æ–‡å­—åˆ—ã®åˆ¤å®šï¼ˆVBAï¼‰

æ—¥ä»˜æ–‡å­—åˆ—ã§ã‚ã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹é–¢æ•° `IsDateFormat()` ã®ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚

```vba:æ—¥ä»˜æ–‡å­—åˆ—ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°ï¼ˆVBAï¼‰
' å¹´æœˆæ—¥ã‚’è¡¨ã™æ–‡å­—åˆ—ãŒã€é©æ­£ã‹ã‚’åˆ¤æ–­
'
' å¼•æ•° dateString As String - 'yyyy-MM-dd' å½¢å¼ã®æ–‡å­—åˆ—
' è¿”ã‚Šå€¤ Boolean - å­˜åœ¨ã—ã†ã‚‹æ—¥ä»˜ã‹ã®åˆ¤å®š
'
Function IsDateFormat(dateString As String) As Boolean

  ' æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆyyyy-MM-ddï¼‰
  Dim dateFormatRegex As Object
  Set dateFormatRegex = CreateObject("VBScript.RegExp")
  With dateFormatRegex
    .IgnoreCase = True
    .Global = False
    .Pattern = "^\d{4}-\d{2}-\d{2}$"
  End With

  If Not dateFormatRegex.test(dateString) Then
    IsDateFormat = False
    Exit Function
  End If

  ' ç°¡æ˜“çš„ãªæœˆæ—¥ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæœˆã®ç¯„å›²ã¯1ï½12ã‹ã€æ—¥ã®ç¯„å›²ã¯1ï½31ã‹ï¼‰
  Dim numYear As Integer
  Dim numMonth As Integer
  Dim numDay As Integer
  numYear = CInt(Split(dateString, "-")(0))
  numMonth = CInt(Split(dateString, "-")(1))
  numDay = CInt(Split(dateString, "-")(2))

  If (numMonth < 1) Or (numMonth > 12) Or (numDay < 1) Or (numDay > 31) Then
    IsDateFormat = False
    Exit Function
  End If

' dateå‹ã«ã‚ˆã‚‹å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆå…¥åŠ›å€¤ãŒ `2/31` ã¨ã„ã£ãŸå­˜åœ¨ã—ãªã„æ—¥ä»˜ã ã£ãŸã‚Šã€é–æ—¥ã«ã‚ˆã‚Šå®Ÿéš›ã®æ—¥ä»˜ã¨ã‚ºãƒ¬ã¦ãªã„ã‹ï¼‰
  Dim dateCheck As Date
  dateCheck = DateSerial(numYear, numMonth, numDay)
  If (Year(dateCheck) <> numYear) Or (Month(dateCheck) <> numMonth) Or (Day(dateCheck) <> numDay) Then
    IsDateFormat = False
    Exit Function
  End If

  IsDateFormat = True
End Function
```

:::details åˆ¥æ¡ˆï¼šErrorã‚’åˆ©ç”¨ã—ãŸå¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯

æœ€å¾Œã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ã«ã¤ã„ã¦ã¯ã€ä¸‹è¨˜ã®**ã‚¨ãƒ©ãƒ¼å‡¦ç†**ã«ã‚ˆã‚‹æ–¹æ³•ã‚‚ä½¿ãˆã¾ã™ã€‚

```vba:Errorã‚’åˆ©ç”¨ã—ãŸå¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
' dateå‹ã«ã‚ˆã‚‹å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆå…¥åŠ›å€¤ãŒ `2/31` ã¨ã„ã£ãŸå­˜åœ¨ã—ãªã„æ—¥ä»˜ã ã£ãŸã‚Šã€é–æ—¥ã«ã‚ˆã‚Šå®Ÿéš›ã®æ—¥ä»˜ã¨ã‚ºãƒ¬ã¦ãªã„ã‹ï¼‰
On Error Resume Next
Dim dateCheck As Date
dateCheck = dateString
If (Err.Number <> 0) Or _
  ((numYear <> Year(dateCheck)) Or (numMonth <> Month(dateCheck)) Or (numDay <> Day(dateCheck))) Then
  IsDateFormat = False
  Exit Function
End If
On Error GoTo 0
```

ã“ã“ã§ã¯å¼•æ•°ã§å—ã‘å–ã£ãŸæ—¥ä»˜æ–‡å­—åˆ—ï¼ˆ`dateString`ï¼‰ã‚’ç›´æ¥ `Date` å‹ã«æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚å­˜åœ¨ã—ãªã„æ—¥ä»˜æ–‡å­—åˆ—ã‚’ `Date` å‹ã«æ ¼ç´ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã®ã§ã€ãã‚Œã‚’åˆ©ç”¨ã—ã¦å¦¥å½“æ€§ã‚’åˆ¤æ–­ã—ã¦ã„ã‚‹ã‚ã‘ã§ã™ã€‚

ãªãŠã€JavaScript ã¨ã¯é•ã£ã¦ VBA ã§ã¯ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã¨å‡¦ç†ã¯ä¸­æ–­ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ãªã®ã§ `On Error Resume Next` ã€œ `On Error GoTo 0` é–“ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãã†ãªå‡¦ç†ã‚’æŒŸã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
ï¼ˆä»–ã®è¨€èªã§è¨€ã†ã€`try` ã€œ `catch` ã¨ä¼¼ãŸã‚ˆã†ãªæ„Ÿã˜ã§ã—ã‚‡ã†ã‹ï¼Ÿï¼‰

:::

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ç‰¹å¾´çš„ãªã®ã¯ã€ä¸‹è¨˜ã®éƒ¨åˆ†ã§ã™ã€‚

- æ­£è¦è¡¨ç¾ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ `RegExp` ã‚’ç”Ÿæˆ

#### æ­£è¦è¡¨ç¾ç”¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ

VBA ã§æ­£è¦è¡¨ç¾ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª `Microsoft VBScript Regular Expressions` ã‹ã‚‰ã€`RegExp` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‘¼ã³å‡ºã™æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

![å‚ç…§è¨­å®šã‹ã‚‰ã€å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® VBScript Regular Expressions ã‚’é¸æŠã—ãŸçŠ¶æ…‹](/images/articles/exercise_in_language__calculate_age/calc_age-05.png)

![VBScriptã‚’å¤–éƒ¨å‚ç…§ã‹ã‚‰å–ã‚Šè¾¼ã‚“ã çŠ¶æ…‹ã§ã€VBEã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€ŒRegExpã€ã‚’æ¤œç´¢ã—ãŸçŠ¶æ…‹](/images/articles/exercise_in_language__calculate_age/calc_age-03.png)

ä»Šå›ã¯ `CreateObject()` ã‚’ä½¿ã£ã¦å‚ç…§è¨­å®šç„¡ã—ã§å‘¼ã³è¾¼ã‚€ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã“ã§å‘¼ã³å‡ºã—ãŸ `RegExp` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ã€ä¸Šå›³ã«ã‚ã‚‹ã‚ˆã†ã« ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ã£ã¦ã€æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹æ—¥ä»˜æ–‡å­—åˆ—ã®ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

### æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã®ç®—å‡ºï¼ˆVBAï¼‰

æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’ç®—å‡ºã—å‡ºåŠ›ã™ã‚‹é–¢æ•° `CalcAgeAndDays()` ã®ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚

```vba:ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’ç®—å‡ºã™ã‚‹é–¢æ•°ï¼ˆVBAï¼‰
' ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’è¨ˆç®—
'
' å¼•æ•° textBirth As String - ç”Ÿå¹´æœˆæ—¥ï¼ˆyyyy-MM-ddå½¢å¼ï¼‰
' å¼•æ•° (Optional) dateBase As Date - è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
'
Function CalcAgeAndDays(textBirth As String, Optional dateBase As Date = 0)
  Dim dateCalc As Date
  If (IsDate(dateBase) = False) Or (dateBase = 0) Then
    dateCalc = Now
  Else
    dateCalc = dateBase
  End If

  If (IsDateFormat(textBirth) = True) Then
    Dim dateBirth As Date
    dateBirth = DateSerial( _
      CInt(Split(textBirth, "-")(0)), _
      CInt(Split(textBirth, "-")(1)), _
      CInt(Split(textBirth, "-")(2)) _
    )
    
    Dim age As Integer
    age = CalcAge(dateBirth, dateCalc)
    
    ' ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
    Dim timeAging As Date
    timeAging = DateSerial( _
      Year(dateBirth) + age, _
      Month(dateBirth), _
      Day(dateBirth) - 1 _
    ) + TimeSerial(24, 0, 0)

    Dim days As Integer
    days = DateDiff("d", timeAging, dateCalc)  ' DateDiffã¯æ¨™æº–ã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹
    
    Debug.Print "å¹´é½¢ã¯ " & age & " æ­³ã€çµŒéæ—¥æ•°ã¯ " & days & " æ—¥ã§ã™"
  End If

End Function
```

## PHP

PHP ã§æ—¥ä»˜ã‚’æ‰±ã†éš›ã¯ã€`DateTime` ã‚¯ãƒ©ã‚¹ã‚’ä½¿ã†ã®ãŒä¸»ã¨ãªã‚Šã¾ã™ã€‚

```php:DateTimeã«ã‚ˆã‚‹æ—¥ä»˜ç”Ÿæˆ
// ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼ˆæ—¥ä»˜æ–‡å­—åˆ—ï¼‰
$date1 = new DateTime('2023-02-29');
echo $date1->format('Y-m-d'), PHP_EOL; // 2023-03-01

// setDateãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆå„ç¨®æ•°å€¤ï¼‰
$date2 = new DateTime();
$date2->setDate(2023,2,29);
echo $date2->format('Y-m-d'), PHP_EOL; // 2023-03-01

$date2->setDate(2023,0,29);
echo $date2->format('Y-m-d'), PHP_EOL; // 2022-12-29
```

https://www.php.net/manual/ja/class.datetime.php

https://www.php.net/manual/ja/datetime.formats.php

:::message

ãªãŠã€PHP ã§ã¯ [`DateTime`ã‚¯ãƒ©ã‚¹](https://www.php.net/manual/ja/class.datetime.php)ã«ã‚ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ [`diff()`](https://www.php.net/manual/ja/datetime.diff.php)ã§ 2 ã¤ã®æ—¥ä»˜ã®å·®åˆ†ã‚’å–ã‚‹ã“ã¨ãŒã§ãã€ç”Ÿæˆã•ã‚ŒãŸ [`DateInterval`ã‚¯ãƒ©ã‚¹](https://www.php.net/manual/ja/class.dateinterval.php)ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ `days` ã§æ—¥æ•°æ›ç®—ãŒã§ãã‚‹ãŸã‚ã€JavaScript ã«ã‚ã£ãŸ `dateDiff()` é–¢æ•°ã‚’è‡ªä½œã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

:::

### æº€å¹´é½¢ã®è¨ˆç®—ï¼ˆPHPï¼‰

```php:æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°ï¼ˆPHPï¼‰
/**
 * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰
 *
 * @param DateTime $dateBirth ç”Ÿå¹´æœˆæ—¥
 * @param DateTime|null $dateBase è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
 * @return int æº€å¹´é½¢
 * @throws InvalidArgumentException å¼•æ•°ãŒ DateTime å‹ã§ãªã„å ´åˆ
 */
function calcAge(DateTime $dateBirth, DateTime $dateBase = null): int {
  // åŸºæº–æ—¥ã‚’ç¾åœ¨ã®æ—¥ä»˜ã«è¨­å®šï¼ˆå¼•æ•°ãŒçœç•¥ã•ã‚ŒãŸå ´åˆï¼‰
  $dateBase = $dateBase ?? new DateTime();

  // å‹ãƒã‚§ãƒƒã‚¯
  if (!($dateBirth instanceof DateTime) || !($dateBase instanceof DateTime)) {
    throw new InvalidArgumentException('å¼•æ•°ã¯ DateTime å‹ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“');
  }

  // å¹´é½¢è¨ˆç®—
  $age = $dateBase->format('Y') - $dateBirth->format('Y');

  // åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¨ˆç®—ï¼ˆèª•ç”Ÿæ—¥ã®å‰æ—¥24æ™‚ï¼‰
  $timeBoundaryForAging =  new DateTime();
  $timeBoundaryForAging -> setDate($dateBirth->format('Y') + $age, $dateBirth->format('m'), $dateBirth->format('d')) 
                        -> modify('-1 day')
                        -> setTime(24, 0, 0, 0);
  
  // æº€å¹´é½¢ã®èª¿æ•´
  if ($timeBoundaryForAging > $dateBase) {
    return $age - 1;
  } else {
    return $age;
  }
}
```

### æ—¥ä»˜æ–‡å­—åˆ—ã®åˆ¤å®šï¼ˆPHPï¼‰

```php:æ—¥ä»˜æ–‡å­—åˆ—ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°ï¼ˆPHPï¼‰
/**
 * å¹´æœˆæ—¥ã‚’è¡¨ã™æ–‡å­—åˆ—ãŒã€é©æ­£ã‹ã‚’åˆ¤æ–­
 *
 * @param string $date 'yyyy-MM-dd' å½¢å¼ã®æ–‡å­—åˆ—
 * @return bool å­˜åœ¨ã—ã†ã‚‹æ—¥ä»˜ã‹ã®åˆ¤å®š
 */
function isDateFormat(string $date): bool {
  if(!preg_match('/\A\d{4}-\d{2}-\d{2}\z/', $date)) return false;
  
  // å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæœˆæ—¥ã®ç°¡æ˜“çš„ãƒã‚§ãƒƒã‚¯ã‚’å«ã‚€ï¼‰
  list($year, $month, $day) = explode("-", $date);
  return checkdate((int)$month, (int)$day, (int)$year);
}
```

:::details ãƒ†ã‚¹ãƒˆ

```php:æ¤œè¨¼ã‚³ãƒ¼ãƒ‰
echo var_export(isDateFormat("2024-02-29")), PHP_EOL;  // -> true
echo var_export(isDateFormat("2023-02-29")), PHP_EOL;  // -> false
```

:::

æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã«é–¢ã—ã¦ã¯ã€PHP4 ä»¥é™ã‹ã‚‰åˆ©ç”¨ã§ãã‚‹ `checkdate()` é–¢æ•°ã‚’ä½¿ã„ã¾ã™ã€‚ã“ã‚Œã¯ `checkdate(int $month, int $day, int $year): bool` ã®å½¢ã¨ãªã£ã¦ãŠã‚Šã€é–å¹´ã‚’è€ƒæ…®ã—ãŸæ—¥ä»˜ã®å¦¥å½“æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€çœŸå½å€¤ã§è¿”ã—ã¦ãã‚Œã‚‹é–¢æ•°ã§ã™ã€‚

https://www.php.net/manual/ja/function.checkdate.php

`\A\d{4}-\d{2}-\d{2}\z/` ã®æ­£è¦è¡¨ç¾ã«ã¤ã„ã¦ã¯ã€å§‹ç«¯çµ‚ç«¯ã«ä½™è¨ˆãªã‚‚ã®ãŒãªã„å½¢ã§ã®ã€Œ4æ¡-2æ¡-2æ¡ã€ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

https://www.php.net/manual/ja/regexp.reference.escape.php

### æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã®ç®—å‡ºï¼ˆPHPï¼‰

```php:ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’ç®—å‡ºã™ã‚‹é–¢æ•°ï¼ˆPHPï¼‰
/**
 * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’è¨ˆç®—
 *
 * @param string $textBirth ç”Ÿå¹´æœˆæ—¥ï¼ˆyyyy-MM-ddå½¢å¼ï¼‰
 * @param DateTime|null $dateBase è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
 * @return void
 */
function calcAgeAndDays(string $textBirth, DateTime $dateBase = null){
  // åŸºæº–æ—¥ã‚’ç¾åœ¨ã®æ—¥ä»˜ã«è¨­å®šï¼ˆå¼•æ•°ãŒçœç•¥ã•ã‚ŒãŸå ´åˆï¼‰
  $dateBase = $dateBase ?? new DateTime();
  
  if(isDateFormat($textBirth)){
    $dateBirth =  new DateTime($textBirth);
    
    $age = calcAge($dateBirth, $dateBase);
    
    // ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
    $timeAging = new DateTime();
    $timeAging -> setDate($dateBirth->format('Y') + $age, $dateBirth->format('m'), $dateBirth->format('d')) 
               -> modify('-1 day')
               -> setTime(24, 0, 0, 0);

    $days = $timeAging -> diff($dateBase) -> days;
    echo "å¹´é½¢ã¯ $age æ­³ã€çµŒéæ—¥æ•°ã¯ $days æ—¥ã§ã™";
  }
}
```

:::details ãƒ†ã‚¹ãƒˆï¼ˆä¸€éƒ¨ï¼‰

```php:æ¤œè¨¼
calcAgeAndDays('2000-02-28', new DateTime('2023-02-28'));  // -> OKï¼šå¹´é½¢ã¯ 23 æ­³ã€çµŒéæ—¥æ•°ã¯ 0 æ—¥ã§ã™
calcAgeAndDays('2000-02-29', new DateTime('2023-02-28'));  // -> OKï¼šå¹´é½¢ã¯ 22 æ­³ã€çµŒéæ—¥æ•°ã¯ 364 æ—¥ã§ã™
calcAgeAndDays('2000-02-29', new DateTime('2024-02-28'));  // -> OKï¼šå¹´é½¢ã¯ 23 æ­³ã€çµŒéæ—¥æ•°ã¯ 364 æ—¥ã§ã™
calcAgeAndDays('2000-03-01', new DateTime('2024-02-29'));  // -> OKï¼šå¹´é½¢ã¯ 23 æ­³ã€çµŒéæ—¥æ•°ã¯ 365 æ—¥ã§ã™
```

:::

## Python

Python å…¨ä½“ã§ä½¿ã† `import` æ–‡ã«é–¢ã—ã¦ã¯ã€ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚

```python:å…¨ä½“ã§ä½¿ç”¨ã™ã‚‹importæ–‡
import re
from datetime import date, datetime, time, timedelta
```

Python ã§ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã«ã¯ã€`date`, `datetime` ã‚’ä½¿ã†ã®ãŒä¸»ã§ã™ã€‚ã—ã‹ã— `date`, `datetime` ã¯ã€ç”Ÿæˆæ™‚ã« **2001/02/29** ã‚„ **2000/03/00** ã¨ã„ã£ãŸã€å­˜åœ¨ã—ãªã„æ—¥ä»˜ã¸ã®èª¿æ•´ãŒè¡Œã‚ã‚Œãªã„ãŸã‚ã€æ—¥ä»˜èª¿æ•´ç”¨ã®é–¢æ•°ã‚’æ‹µãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```python:æ•°å€¤ã‹ã‚‰ã®æ—¥ä»˜ç”Ÿæˆ
def generate_date(year: int, month: int, day: int):
  """
  å­˜åœ¨ã—ãªã„æ—¥ä»˜ã«å¯¾å¿œã™ã‚‹å½¢ã§ date ã‚’ä½œæˆã™ã‚‹

  Args:
    year (int): å¹´
    month (int): æœˆ
    day (int): æ—¥

  Returns:
    date: æ—¥ä»˜ï¼ˆé–æ—¥ãªã©ã‚’èª¿æ•´ã—ãŸå½¢ï¼‰
  """
  try:
    return date(year, month, day)
  except ValueError:
    # ç„¡åŠ¹ãªæ—¥ä»˜ã®å ´åˆã€èª¿æ•´ã™ã‚‹
    if day == 0:
      adjusted_date = date(year, month, 1) - timedelta(days=1)
    else:
      adjusted_date = date(year, month, 1) + timedelta(days=day - 1)
    return adjusted_date
```

:::message

ãªãŠã€Python ã§ã¯ [`datetime`ã‚¯ãƒ©ã‚¹](https://docs.python.org/ja/3.13/library/datetime.html)åŒå£«ã§å¼•ãç®—ã™ã‚‹ã¨ `datetime.timedelta` ã¨ãªã‚Šã€`timedelta.days` ã§æ—¥æ•°ã‚’å–ã‚Šå‡ºã›ã‚‹ãŸã‚ã€JavaScript ã«ã‚ã£ãŸ `dateDiff()` é–¢æ•°ã‚’è‡ªä½œã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

:::

### æº€å¹´é½¢ã®è¨ˆç®—ï¼ˆPythonï¼‰

```python:æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°ï¼ˆPythonï¼‰
def calc_age(date_birth: date, date_base: date = date.today()) -> int:
  """
  ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰

  Args:
    date_birth (date): ç”Ÿå¹´æœˆæ—¥
    date_base (date, optional): è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰

  Returns:
    int: æº€å¹´é½¢

  Raises:
    ValueError: å¼•æ•°ãŒ datetime å‹ã§ãªã„å ´åˆ
  """

  # å‹ãƒã‚§ãƒƒã‚¯
  if (not isinstance(date_birth, date)) or (not isinstance(date_base, date)):
    raise ValueError("å¼•æ•°ã¯ date å‹ã§æŒ‡å®šã—ã¦ãã ã•ã„")

  # å¹´é½¢è¨ˆç®—
  age = date_base.year - date_birth.year

  # åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆè¨ˆç®—åŸºæº–å¹´ï¼‰ã¯ã€èª•ç”Ÿæ—¥ã®å‰æ—¥24æ™‚
  time_boundary_for_aging = datetime.combine(generate_date(date_base.year, date_birth.month, date_birth.day -1), time(0, 0, 0)) + timedelta(hours = 24)

  # æº€å¹´é½¢ã¯ã€åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ã¾ã è¶Šãˆã¦ã„ãªã„å ´åˆã€ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦è¿”ã™
  if time_boundary_for_aging > datetime.combine(date_base, time(0, 0, 0)):
    return age - 1
  else:
    return age
```

### æ—¥ä»˜æ–‡å­—åˆ—ã®åˆ¤å®šï¼ˆPythonï¼‰

```python:æ—¥ä»˜æ–‡å­—åˆ—ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°ï¼ˆPythonï¼‰
def is_date_format(date_string: str) -> bool:
  """
  å¹´æœˆæ—¥ã‚’è¡¨ã™æ–‡å­—åˆ—ãŒã€é©æ­£ã‹ã‚’åˆ¤æ–­

  Args:
    date_string (str): 'yyyy-MM-dd' å½¢å¼ã®æ–‡å­—åˆ—

  Returns:
    bool: å­˜åœ¨ã—ã†ã‚‹æ—¥ä»˜ã‹ã®åˆ¤å®š
  """
  # æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆyyyy-MM-ddï¼‰
  date_format_regex = r"^\d{4}-\d{2}-\d{2}$"
  if not re.match(date_format_regex, date_string):
    return False

  # ç°¡æ˜“çš„ãªæœˆæ—¥ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæœˆã®ç¯„å›²ã¯1ã€œ12ã‹ã€æ—¥ã®ç¯„å›²ã¯1ã€œ31ã‹ï¼‰
  try:
    year, month, day = map(int, date_string.split('-'))
  except ValueError:
    return False

  if not ((1 <= month <= 12) and (1 <= day <= 31)):
    return False

  # æ—¥ä»˜ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
  date_check = generate_date(year, month, day)
  if(date_check.year != year or date_check.month != month or date_check.day != day):
    return False
  else:
    return True
```

:::details ãƒ†ã‚¹ãƒˆ

```python:ãƒ†ã‚¹ãƒˆæ–‡
print(is_date_format("2021-04-30"))  # True
print(is_date_format("2025-01-18"))  # True
print(is_date_format("2024-02-29"))  # True
print(is_date_format("2023-02-29"))  # False
print(is_date_format("2021-04-31"))  # False
print(is_date_format("2025-02-30"))  # False
print(is_date_format("abcd-01-01"))  # False
print(is_date_format("2025-13-01"))  # False
print(is_date_format("2025-01-32"))  # False
```

:::

:::details åˆ¥æ¡ˆï¼šã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹æ–¹æ³•

æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹ãƒã‚§ãƒƒã‚¯ã®éƒ¨åˆ†ã«ã¤ã„ã¦ã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚

```python:compileã™ã‚‹å ´åˆ
# æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆyyyy-MM-ddï¼‰
date_format_regex = re.compile(r'^\d{4}-\d{2}-\d{2}$')
if not date_format_regex.match(date_string):
  return False
```

ãŸã ã—æœ¬ã‚±ãƒ¼ã‚¹ã«ãŠã„ã¦ã¯ã€åˆ©ç”¨å ´é¢ã¯é™ã‚‰ã‚Œã¦ãŠã‚Š ã¾ãŸå†åˆ©ç”¨ã‚’è€ƒæ…®ã—ãªã„ãŸã‚ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å‰‡ã‚Šæ¡ç”¨ã¯ã—ã¾ã›ã‚“ã§ã—ãŸã€‚

> `re.compile()` ã‚’ä½¿ã„ã€çµæœã®æ­£è¦è¡¨ç¾ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿å­˜ã—ã¦å†åˆ©ç”¨ã™ã‚‹ã»ã†ãŒã€ä¸€ã¤ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ãã®è¡¨ç¾ã‚’ä½•å›ã‚‚ä½¿ã†ã¨ãã«åŠ¹ç‡çš„ã§ã™ã€‚
>
> **æ³¨é‡ˆ** `re.compile()` ã‚„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«ã®ãƒãƒƒãƒãƒ³ã‚°é–¢æ•°ã«æ¸¡ã•ã‚ŒãŸæœ€æ–°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ã®ã‚‚ã®ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ã®ã§ã€ä¸€åº¦ã«æ­£è¦è¡¨ç¾ã‚’å°‘ã—ã—ã‹ä½¿ã‚ãªã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã¯æ­£è¦è¡¨ç¾ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
>
> ã€[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.python.org/ja/3/library/re.html#re.compile)ã€ã‚ˆã‚Šä¸€éƒ¨æŠœç²‹

:::

:::details åˆ¥æ¡ˆï¼šValueErrorã‚’åˆ©ç”¨ã—ãŸå®Ÿåœ¨ãƒ†ã‚¹ãƒˆ

ã¾ãŸã€`datetime`, `date` ã¯å®Ÿåœ¨ã—ãªã„æ—¥ä»˜ï¼ˆé–å¹´ã®è€ƒãˆã‚’å«ã‚€ï¼‰ã§ç”Ÿæˆã—ã‚ˆã†ã¨ã™ã‚‹ã¨ `ValueError: day is out of range for month` ã¨è¨€ã£ãŸã‚ˆã†ã«ã‚¨ãƒ©ãƒ¼ã‚’åãå‡ºã—ã¾ã™ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã™ã‚‹å½¢ã§å®Ÿåœ¨ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```python:å®Ÿåœ¨ãƒ†ã‚¹ãƒˆã®åˆ¥è§£
try:
  # ãƒ‘ã‚¿ãƒ¼ãƒ³1ï¼šdatetime.strptime() ã«ã‚ˆã‚‹å®Ÿåœ¨ãƒ†ã‚¹ãƒˆ
  datetime.strptime(date_string, '%Y-%m-%d')

  # ãƒ‘ã‚¿ãƒ¼ãƒ³2ï¼šdate ã«ã‚ˆã‚‹å®Ÿåœ¨ãƒ†ã‚¹ãƒˆ
  date(year, month, day)
  return True
except ValueError:
  return False
```

:::

### æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã®ç®—å‡ºï¼ˆPythonï¼‰

```python:ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’ç®—å‡ºã™ã‚‹é–¢æ•°ï¼ˆPythonï¼‰
def calc_age_and_days(text_birth: str, date_base: date = date.today()):
  """
  ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’ç®—å‡º

  Args:
    text_birth (str): ç”Ÿå¹´æœˆæ—¥ï¼ˆ'yyyy-MM-dd' å½¢å¼ï¼‰
    date_base (date, optional): è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
  """
  if(is_date_format(text_birth)):
    year, month, day = map(int, text_birth.split('-'))
    date_birth = generate_date(year, month, day)

    age = calc_age(date_birth, date_base)

    # ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’ èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
    time_aging = datetime.combine(generate_date(date_birth.year + age, date_birth.month, date_birth.day -1), time(0, 0, 0)) + timedelta(hours = 24)

    days = datetime.combine(date_base, time(0, 0, 0)) - time_aging
    print(f"{age}æ­³ã€{days.days}æ—¥çµŒé")
```

## Java

Java ã§ä½¿ã† `import` æ–‡ã¯ã€å…¨ä½“ã¨ã—ã¦ã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚

```java:å…¨ä½“ã§ä½¿ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé›†
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.temporal.ChronoUnit;
import java.time.format.DateTimeFormatter;
import java.time.format.ResolverStyle;

// æ¤œè¨¼ç”¨ã«ä½¿ç”¨
import java.util.Arrays;
import java.util.List;
```

ã¾ãŸã€Java ã«ãŠã„ã¦ã¯æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„ã¯ `LocalDate`ï¼ˆã¾ãŸã¯ `LocalDateTime`ï¼‰ãŒä¸»ã¨ãªã‚Šã¾ã™ãŒã€å­˜åœ¨ã—ãªã„æ—¥ä»˜ã‚’ä½¿ã£ãŸç”ŸæˆãŒé›£ã—ã„ã§ã™ã€‚ãã®ãŸã‚ã€ç”Ÿæˆç”¨ã®é–¢æ•°ã‚’è¨­ã‘ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```java:å¯›å®¹ã«LocalDateã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
/**
 * å­˜åœ¨ã—ãªã„æ—¥ä»˜å€¤ã‹ã‚‰ã‚‚å¯›å¤§ãªå½¢ã§ LocalDate ã‚’ç”Ÿæˆã™ã‚‹ï¼ˆä¾‹ï¼š1999-02-29 â†’ 1999-03-01ï¼‰
 * 
 * @param year å¹´
 * @param month æœˆ
 * @param day æ—¥
 * @return LocalDate èª¿æ•´ã•ã‚ŒãŸæ—¥ä»˜ãƒ‡ãƒ¼ã‚¿
 */
public static LocalDate generateLocalDateWithLenient(int year, int month, int day) {
  DateTimeFormatter dtf = DateTimeFormatter.ISO_LOCAL_DATE.withResolverStyle(ResolverStyle.LENIENT);
  return LocalDate.parse(String.format("%04d-%02d-%02d", year, month, day), dtf);
}
```

`LocalDate`(`LocalDateTime`) ã¯é–æ—¥ç­‰ã‚‚è€ƒæ…®ã—ã¦ãã‚Œã‚‹ã®ã§ã€ãã‚Œè‡ªèº«ã«å¯¾ã—ã¦ã®æ—¥æ•°ã‚„æ™‚é–“ã®åŠ ç®—ã«å¯¾ã—ã¦ã¯å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆä¾‹ï¼š`{LocalDateTime}.minusDays(1).plusHours(24)`ï¼‰

ã—ã‹ã— `LocalDate.of(int year, int month, int day)` ã§ç”Ÿæˆã™ã‚‹å ´åˆã€å­˜åœ¨ã—ãªã„æ—¥ä»˜å€¤ã ã¨ `DateTimeParseException` ãŒç”Ÿã˜ã¦ã—ã¾ã„ã¾ã™ã€‚

ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã¯ å¾Œã»ã©ç™»å ´ã™ã‚‹é–¢æ•°ã®ä¸€éƒ¨ã§ã€ä½œæˆå½“åˆã®çŠ¶æ…‹ã§ã™ã€‚ç”Ÿå¹´æœˆæ—¥ã¨è¨ˆç®—åŸºæº–æ—¥ã‹ã‚‰æ–°ãŸã«æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã‚ˆã†ã¨ã—ã¦ã¾ã™ãŒã€ä¸¡æ–¹ã§å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

```java:ã‚¨ãƒ©ãƒ¼ä¾‹ï¼‘ï¼šèª•ç”Ÿæ—¥ãŒé–æ—¥ã®å ´åˆã«å•é¡Œ
// æº€å¹´é½¢ã«ãªã£ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ç”Ÿæˆï¼ˆâ‰’ èª•ç”Ÿæ—¥å‰æ—¥ã® 24 æ™‚ï¼‰
LocalDateTime timeBoundaryForAging = LocalDateTime.of(
 birthDate.getYear() + age, birthDate.getMonthValue(), birthDate.getDayOfMonth(), 0, 0
).minusDays(1).plusHours(24);
// ã“ã®å ´åˆ `dateBirth` ãŒ 2000/02/29 ã ã¨ã€`age` ã®å€¤ã«ã‚ˆã£ã¦ã¯é–å¹´ã§ãªã„é–æ—¥ã‚’ç”Ÿæˆã—ã‹ã­ãªã„
```

```java:ã‚¨ãƒ©ãƒ¼ä¾‹ï¼’ï¼šèª•ç”Ÿæ—¥ãŒï¼‘æ—¥ã®å ´åˆã«å•é¡Œ
LocalDateTime timeBoundaryForAging = LocalDateTime.of(
 birthDate.getYear() + age, birthDate.getMonthValue(), birthDate.getDayOfMonth() - 1, 0, 0
).plusHours(24);
// ã“ã®å ´åˆ `dateBirth` ã®æ—¥ãŒ 1 ã ã¨ã€å¼•æ•°ã¨ãªã‚‹æ—¥æ•°ãŒ 0 ã¨ãªã‚‹
```

ã“ã†ã—ãŸã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€`DateTimeFormatter` ãŒæŒã¤ `ResolverStyle`ï¼ˆæ—¥ä»˜æ–‡å­—åˆ—ã‚’è§£æã™ã‚‹éš›ã®å‹•ä½œã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ã‚’ä½¿ã„ã€`LENIENT`(å¯›å®¹)ã§ç”Ÿæˆã§ãã‚‹ã‚ˆã†ã«é–¢æ•°ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

:::message

ãªãŠ Java ã§ã¯æ—¥ä»˜é–“ã®è¨ˆç®—ã¯ `Period` ã‚„ `Duration` ã‚¯ãƒ©ã‚¹ã€ã‚ã‚‹ã„ã¯ `ChronoUnit.DAYS.between()` ã‚’ä½¿ã£ã¦å®¹æ˜“ã«è¡Œãˆã‚‹ã®ã§ã€JavaScript ã«ã‚ã£ãŸ `dateDiff()` é–¢æ•°ã‚’è‡ªä½œã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

:::

### æº€å¹´é½¢ã®è¨ˆç®—ï¼ˆJavaï¼‰

```java:æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°ï¼ˆJavaï¼‰
/**
 * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰
 *
 * @param birthDate ç”Ÿå¹´æœˆæ—¥
 * @param baseDate  è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
 * @return int æº€å¹´é½¢
 */
public static int calcAge(LocalDate birthDate, LocalDate baseDate){
  if (baseDate == null) baseDate = LocalDate.now();
  int age = baseDate.getYear() - birthDate.getYear();

  // åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆè¨ˆç®—åŸºæº–å¹´ï¼‰ã¯ã€èª•ç”Ÿæ—¥ã®å‰æ—¥24æ™‚
  LocalDateTime timeBoundaryForAging = generateLocalDateWithLenient(
    baseDate.getYear(), birthDate.getMonthValue(), birthDate.getDayOfMonth() - 1
  ).atTime(0, 0).plusHours(24);
  LocalDateTime baseDateTime = baseDate.atTime(0, 0);

  // æº€å¹´é½¢ã¯ã€åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ ã¾ã è¶Šãˆã¦ã„ãªã„å ´åˆã€ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦è¿”ã™
  if (timeBoundaryForAging.isAfter(baseDateTime)) {
    return age - 1;
  } else {
    return age;
  }
}
```

:::details åˆ¥æ¡ˆï¼šæœŸé–“ã‚’æ‰±ã†ã‚¯ãƒ©ã‚¹ã®åˆ©ç”¨

Java ã§ã¯ï¼’ã¤ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã®æ„Ÿè¦šã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã«ã€`Period`ï¼ˆå¹´æœˆæ—¥ï¼‰ã‚„ `Duration`ï¼ˆæ™‚é–“ï¼‰ãŒã‚ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚’ä½¿ã†ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```java:ageã®å–å¾—æ–¹æ³•ã®åˆ¥æ¡ˆ
// Periodã‚¯ãƒ©ã‚¹ã‚’åˆ©ç”¨ã—ã¦æœŸé–“ã‚’è¨ˆç®—ã—ã€å¹´æ•°ã‚’å–å¾—
Period period = Period.between(birthDate, baseDate);
int age = period.getYears();
```

:::

### æ—¥ä»˜æ–‡å­—åˆ—ã®åˆ¤å®šï¼ˆJavaï¼‰

```java:æ—¥ä»˜æ–‡å­—åˆ—ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°ï¼ˆJavaï¼‰
  /**
   * å¹´æœˆæ—¥ã‚’è¡¨ã™æ–‡å­—åˆ—ãŒã€é©æ­£ã‹ã‚’åˆ¤æ–­
   *
   * @param dateString 'yyyy-MM-dd' å½¢å¼ã®æ–‡å­—åˆ—
   * @return boolean å­˜åœ¨ã—ã†ã‚‹æ—¥ä»˜ã‹ã®åˆ¤å®š
   */
  public static boolean isDateFormat(String dateString){
    // æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆyyyy-MM-ddï¼‰
    String dateFormatRegex = "^\\d{4}-\\d{2}-\\d{2}$";
    if (!dateString.matches(dateFormatRegex)) return false;

    // ç°¡æ˜“çš„ãªæœˆæ—¥ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæœˆã®ç¯„å›²ã¯1ã€œ12ã‹ã€æ—¥ã®ç¯„å›²ã¯1ã€œ31ã‹ï¼‰
    String[] dateValues = dateString.split("-");
    int year = Integer.parseInt(dateValues[0]);
    int month = Integer.parseInt(dateValues[1]);
    int day = Integer.parseInt(dateValues[2]);
    if(month < 1 || month > 12 || day < 1 || day > 31) return false;

    // å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆå…¥åŠ›å€¤ãŒ `2/31` ã¨ã„ã£ãŸå­˜åœ¨ã—ãªã„æ—¥ä»˜ã ã£ãŸã‚Šã€é–æ—¥ã«ã‚ˆã‚Šå®Ÿéš›ã®æ—¥ä»˜ã¨ã‚ºãƒ¬ã¦ãªã„ã‹ï¼‰
    LocalDate dateCheck = generateLocalDateWithLenient(year, month, day);
    if (dateCheck.getYear() != year || dateCheck.getMonthValue() != month || dateCheck.getDayOfMonth() != day) return false;

    return true;
  }
```

æ­£è¦è¡¨ç¾ã®éƒ¨åˆ†ã¯ã€`import java.util.regex.Pattern;` ã§å‘¼ã³å‡ºã—ãŸ `Pattern.matches()` ã§è¡Œã†ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

:::details åˆ¥æ¡ˆï¼šSimpleDateFormatã‚’ä½¿ã£ãŸæ–¹æ³•

æœ€å¾Œã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ã®éƒ¨åˆ†ã§ã¯ã€`generateLocalDateWithLenient()` ã‚’ä½¿ã£ã¦ `LocalDate` ã‚’ä½œã£ã¦ã‚ºãƒ¬ãŒãªã„ã‹ã‚’ç¢ºã‹ã‚ã¦ã„ã¾ã™ã€‚ã“ã®é–¢æ•°ãŒãªã„å ´åˆã¯ã€`try` æ–‡ã‚’è¨­ã‘ã¦ä¸­ã§æ¤œè¨¼ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚å½“åˆã¯ `SimpleDateFormat` ã® `setLenient` ã‚’ä½¿ã£ã¦ã¾ã—ãŸï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ `true` ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€æ˜ç¤ºã™ã‚‹æ„å›³ã§ä¸€æ–‡è¨­ã‘ã¦ã„ã¾ã™ï¼‰

```java:SimpleDateFormatã«ã‚ˆã‚‹åˆ¥æ¡ˆ
// å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆå…¥åŠ›å€¤ãŒ `2/31` ã¨ã„ã£ãŸå­˜åœ¨ã—ãªã„æ—¥ä»˜ã ã£ãŸã‚Šã€é–æ—¥ã«ã‚ˆã‚Šå®Ÿéš›ã®æ—¥ä»˜ã¨ã‚ºãƒ¬ã¦ãªã„ã‹ï¼‰
try {
  SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
  sdf.setLenient(true);
  Date date = sdf.parse(dateString);
  LocalDate ld = LocalDate.parse(sdf.format(date), DateTimeFormatter.ISO_LOCAL_DATE);
  if(ld.getYear() != year || ld.getMonthValue() != month || ld.getDayOfMonth() != day) return false;
} catch (ParseException | DateTimeParseException e) {
  return false;
}
```

:::

### æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã®ç®—å‡ºï¼ˆJavaï¼‰

```java:ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’ç®—å‡ºã™ã‚‹é–¢æ•°ï¼ˆJavaï¼‰
/**
 * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰
 *
 * @param birthDate ç”Ÿå¹´æœˆæ—¥
 * @param baseDate  è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
 * @return void
 */
public static void calcAgeAndDays(String textBirth, LocalDate baseDate){
  if (baseDate == null) baseDate = LocalDate.now();

  if (isDateFormat(textBirth)) {
    LocalDate birthDate = LocalDate.parse(textBirth, DateTimeFormatter.ISO_LOCAL_DATE);

    int age = calcAge(birthDate, baseDate);

    // ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
    LocalDateTime timeAging = generateLocalDateWithLenient(
      birthDate.getYear() + age, birthDate.getMonthValue(), birthDate.getDayOfMonth() -1
    ).atTime(0,0).plusHours(24);
    LocalDateTime baseDateTime = baseDate.atTime(0, 0);

    // è¨ˆç®—åŸºæº–æ—¥ã¨ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°é–“ã®æ—¥æ•°ã‚’ç®—å‡º
    long days = ChronoUnit.DAYS.between(timeAging, baseDateTime);

    System.out.println("æº€å¹´é½¢: " + age + "çµŒéæ—¥æ•°: " + days);
  }
}
```

çµŒéæ—¥æ•°ã®ç®—å‡ºã«ã¯ã€`ChronoUnit.DAYS.between()` ã‚’ä½¿ã£ã¦ã¾ã™ãŒã€`Duration.between().toDays()` ã§ã‚‚ã„ã„ã§ã™ã€‚

## Cè¨€èª

å…¨ä½“ã§å¿…è¦ã¨ãªã‚‹ã‚‚ã®ã¯ã€ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚

```c:å…¨ä½“ã§å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª
#include <stdio.h>
#include <time.h>
#include <string.h>
#include <regex.h>
#include <stdlib.h>
```

C è¨€èªã§æ—¥æ™‚ã‚’æ‰±ã†éš›ã«ã¯ã€`tm` æ§‹é€ ä½“ã‚„ `time_t` å‹ã‚’ä½¿ã†ã®ãŒä¸»ã¨ãªã‚Šã¾ã™ã€‚å­˜åœ¨ã—ãªã„æ—¥ä»˜ã«ã¤ã„ã¦ã¯è‡ªå‹•ã§èª¿æ•´ã¯ã—ã¦ãã‚Œãªã„ã®ã§ã€é©æ­£ãªæ—¥ä»˜å€¤ã«èª¿æ•´ã™ã‚‹é–¢æ•°ã‚’ä½œæˆã—ã¦ãŠãã¾ã™ã€‚

```c:é©æ­£ãªæ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã«èª¿æ•´ã™ã‚‹é–¢æ•°
void adjustDate(int *year, int *month, int *day){
  struct tm date = {0};
  date.tm_year = *year - 1900;
  date.tm_mon = *month - 1;
  date.tm_mday = *day;

  // tm æ§‹é€ ä½“ã‚’ time_t ã«å¤‰æ›ï¼ˆé©æ­£ã§ãªã„å€¤ã¯ mktimeã€€é–¢æ•°å†…ã§èª¿ç¯€ï¼‰
  mktime(&date);

  *year = date.tm_year + 1900;
  *month = date.tm_mon + 1;
  *day = date.tm_mday;
}
```

ã“ã‚Œã¯å¼•æ•°ã¨ãªã‚‹ `year`, `month`, `day` ã‚’ãƒã‚¤ãƒ³ã‚¿ã§å—ã‘å–ã£ã¦ã„ã¾ã™ã€‚å‚ç…§ã®å½¢ã§å—ã‘å–ã£ã¦ãŠã `time_t` ã«å¤‰æ›ã€ãã®éš›ã«èª¿æ•´ã•ã‚ŒãŸå„ç¨®å€¤ã‚’ãƒã‚¤ãƒ³ã‚¿ã‚’ä½¿ã£ã¦å…¥ã‚Œç›´ã™ã“ã¨ã§ å­˜åœ¨ã™ã‚‹æ—¥ä»˜å€¤ã«ãªã‚‹ã‚ˆã†å‡¦ç†ã—ã¦ã„ã¾ã™ã€‚

### æº€å¹´é½¢ã®è¨ˆç®—ï¼ˆCè¨€èªï¼‰

```c:æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°ï¼ˆCè¨€èªï¼‰
int calcAge(struct tm dateBirth, struct tm *dateBase){
  // ç¾åœ¨ã®æ—¥ä»˜ã‚’å–å¾—ï¼ˆdateBaseãŒNullã®å ´åˆã¯ç¾åœ¨ã‚’ä½¿ç”¨ï¼‰
  time_t now = time(NULL);
  struct tm dateCalc = *localtime(&now);
  if(dateBase != NULL) dateCalc = *dateBase;

  // å¹´é½¢ã‚’è¨ˆç®—
  int age = dateCalc.tm_year - dateBirth.tm_year;

  // æº€å¹´é½¢æ™‚ã®å‰æ—¥24æ™‚ã‚’ç”Ÿæˆ
  struct tm timeBoundaryForAging = {0};
  timeBoundaryForAging.tm_year = dateCalc.tm_year;
  timeBoundaryForAging.tm_mon = dateBirth.tm_mon;
  timeBoundaryForAging.tm_mday = dateBirth.tm_mday -1;
  timeBoundaryForAging.tm_hour = 24;

  time_t boundaryTime = mktime(&timeBoundaryForAging);

  // æº€å¹´é½¢ã‚’èª¿æ•´
  if (difftime(boundaryTime, mktime(&dateCalc)) > 0) {
    return age - 1;
  } else {
    return age;
  }
};
```

:::details ãƒ†ã‚¹ãƒˆ

```c:æ‰‹å‹•ãƒ†ã‚¹ãƒˆç”¨
void testCalcAge(void){
  // ç”Ÿå¹´æœˆæ—¥ã®å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã€é©æ­£ãªæ—¥ä»˜ã¨ã—ã¦èª¿æ•´
  char textBirth[11];
  int birthYear, birthMonth, birthDay;
  printf("ç”Ÿå¹´æœˆæ—¥ã‚’ 10 æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š2000-01-23ï¼‰: ");
  scanf("%s", textBirth);
  sscanf(textBirth, "%d-%d-%d", &birthYear, &birthMonth, &birthDay);

  struct tm dateBirth = {0};
  dateBirth.tm_year = birthYear - 1900;
  dateBirth.tm_mon = birthMonth - 1;
  dateBirth.tm_mday = birthDay;

  // è¨ˆç®—åŸºæº–æ—¥ã®å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã€é©æ­£ãªæ—¥ä»˜ã¨ã—ã¦èª¿æ•´
  char textBase[11];
  struct tm dateBase = {0};
  printf("è¨ˆç®—æ—¥ã‚’ 10 æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ0 å…¥åŠ›ã§ä»Šæ—¥ã«ã—ã¾ã™ï¼‰: ");
  scanf("%s", textBase);
  if(strcmp(textBase, "0") == 0){
    // ç¾åœ¨ã®æ—¥ä»˜ã‚’å–å¾—
    time_t now = time(NULL);
    dateBase = *localtime(&now);
  }else{
    // è¨ˆç®—åŸºæº–æ—¥ã‚’é©æ­£ãªæ—¥ä»˜ã¨ã—ã¦èª¿æ•´
    int baseYear, baseMonth, baseDay;
    sscanf(textBase, "%d-%d-%d", &baseYear, &baseMonth, &baseDay);

    dateBase.tm_year = baseYear - 1900;
    dateBase.tm_mon = baseMonth - 1;
    dateBase.tm_mday = baseDay;
  }

  // æº€å¹´é½¢ã‚’è¨ˆç®—
  int age = calcAge(dateBirth, &dateBase);
  printf("æº€å¹´é½¢: %d\n", age);
}



int main(){
  while(1){
    static int isContinue = 1;

    // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    testCalcAge();

    printf("ç¶šã‘ã¾ã™ã‹ï¼Ÿ 0 ã§çµ‚äº†ã—ã¾ã™ã€‚: ");
    scanf("%d", &isContinue);
    if(isContinue == 0) break;
  }
  return 0;
}
```

:::

### æœŸé–“å†…ã®æ—¥æ•°è¨ˆç®—ï¼ˆCè¨€èªï¼‰

```c:æœŸé–“ã®æ—¥æ•°ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°ï¼ˆCè¨€èªï¼‰
int absDiffTime(time_t time1, time_t time2){
  return abs((int)(difftime(time1, time2) / (60 * 60 * 24)));
}
```

### æ—¥ä»˜æ–‡å­—åˆ—ã®åˆ¤å®šï¼ˆCè¨€èªï¼‰

```c:æ—¥ä»˜æ–‡å­—åˆ—ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°ï¼ˆCè¨€èªï¼‰
int isDateFormat(char *text){
  int result = 1;

  // æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹åˆ¤å®š
  regex_t ptnBuf;
  const char regex[] = "^[0-9]{4}-[0-9]{2}-[0-9]{2}$";
  if(regcomp(&ptnBuf, regex, REG_EXTENDED | REG_NOSUB) == 0){
    int year, month, day;
    sscanf(text, "%d-%d-%d", &year, &month, &day);

    // å„å€¤ãŒé©æ­£ã‹ã©ã†ã‹ã‚’åˆ¤å®šï¼ˆæœˆæ•°ã€æ—¥æ•°ãŒç¾å®Ÿã®ç¯„å›²å†…ã‹ï¼‰
    if((month >= 1 && month <= 12) && (day >= 1 && day <= 31)){
      // å„å€¤ã®ã‚³ãƒ”ãƒ¼ã‚’ adjustDate é–¢æ•°ã«é€šã—ã€å¤‰åŒ–ã—ãªã„ã‹ã§åˆ¤å®š
      int yearCopy = year, monthCopy = month, dayCopy = day;
      adjustDate(&yearCopy, &monthCopy, &dayCopy);
      if(year == yearCopy && month == monthCopy && day == dayCopy){
        result = 0;
      }
    }
  }

  // é ˜åŸŸã‚’è§£æ”¾ã—ã€çµæœã‚’è¿”ã™
  regfree(&ptnBuf);
  return result;
}
```

:::details ãƒ†ã‚¹ãƒˆ

```c:æ‰‹å‹•ãƒ†ã‚¹ãƒˆç”¨
void testIsDateFormat(void){
  char textTest[11];
  printf("ãƒ†ã‚¹ãƒˆã™ã‚‹æ—¥ä»˜ã‚’ 10 æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š2000-01-23ï¼‰: ");
  scanf("%s", textTest);
  char textResult[4];
  if(isDateFormat(textTest) == 0){
    strcpy(textResult, "OK");
  }else{
    strcpy(textResult, "NG");
  }
  // å…¥åŠ›å€¤ã¨çµæœã®è¡¨ç¤º
  printf("å…¥åŠ›å€¤: %s, çµæœ: %s\n", textTest, textResult);
}



int main(){
  while(1){
    static int isContinue = 1;

    // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    testIsDateFormat();

    printf("ç¶šã‘ã¾ã™ã‹ï¼Ÿ 0 ã§çµ‚äº†ã—ã¾ã™ã€‚: ");
    scanf("%d", &isContinue);
    if(isContinue == 0) break;
  }
  return 0;
}
```

:::

ä»–è¨€èªã¨é•ã„ã€ã“ã“ã§ã¯æŒ™å‹•ã®æµã‚Œã‚’å¤‰ãˆã¦ã„ã¾ã™ã€‚

ä»–ã®è¨€èªã§ã¯ã€æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ãªã„æ™‚ç‚¹ã§ `return false;` ã¨ã„ã£ãŸå½¢ã§é–¢æ•°ã‚’æŠœã‘ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã€‚ä¸€æ–¹ã® C è¨€èªã§ã¯ ã©ã®ã‚±ãƒ¼ã‚¹ã§ã‚‚ãƒ–ãƒ­ãƒƒã‚¯æœ€å¾Œã¾ã§è¡Œãã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯æ­£è¦è¡¨ç¾ç”¨ã«ç¢ºä¿ã—ãŸãƒ¡ãƒ¢ãƒªé ˜åŸŸã‚’ `regfree()` ã§è§£æ”¾ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚

### æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã®ç®—å‡ºï¼ˆCè¨€èªï¼‰

```c:ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’ç®—å‡ºã™ã‚‹é–¢æ•°ï¼ˆCè¨€èªï¼‰
void calcAgeAndDays(void){
  // ç”Ÿå¹´æœˆæ—¥ã®å…¥åŠ›
  char textBirth[11];
  printf("ç”Ÿå¹´æœˆæ—¥ã‚’ 10 æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š2000-01-23ï¼‰: ");
  scanf("%s", textBirth);

  // ç”Ÿå¹´æœˆæ—¥ã®å½¢å¼ãƒã‚§ãƒƒã‚¯
  if(isDateFormat(textBirth) != 0){
    printf("ç”Ÿå¹´æœˆæ—¥ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“\n");
    return;
  } else {
    // å…¥åŠ›å€¤ã‹ã‚‰ tm æ§‹é€ ä½“ã‚’ç”Ÿæˆ
    int birthYear, birthMonth, birthDay;
    sscanf(textBirth, "%d-%d-%d", &birthYear, &birthMonth, &birthDay);

    struct tm dateBirth = {0};
    dateBirth.tm_year = birthYear - 1900;
    dateBirth.tm_mon = birthMonth - 1;
    dateBirth.tm_mday = birthDay;

    // è¨ˆç®—åŸºæº–æ—¥ã®å…¥åŠ›
    char textBase[11];
    printf("è¨ˆç®—æ—¥ã‚’ 10 æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ0 å…¥åŠ›ã§ä»Šæ—¥ã«ã—ã¾ã™ï¼‰: ");
    scanf("%s", textBase);

    // å…¥åŠ›å€¤ã«å¿œã˜ãŸå‡¦ç†åˆ†å²
    struct tm dateBase = {0};
    if(strcmp(textBase, "0") == 0){
      // ç¾åœ¨ã®æ—¥ä»˜æƒ…å ±ã‚’ dateBase ã«ä»£å…¥
      time_t now = time(NULL);
      dateBase = *localtime(&now);
    } else if(isDateFormat(textBase) != 0){
      // é©æ­£ãªæ—¥ä»˜å½¢å¼ã§ãªã„ãŸã‚ã‚„ã‚Šç›´ã—
      printf("è¨ˆç®—æ—¥ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“\n");
      return;
    } else {
      // å…¥åŠ›å€¤ã‹ã‚‰ tm æ§‹é€ ä½“ã‚’ç”Ÿæˆ
      int baseYear, baseMonth, baseDay;
      sscanf(textBase, "%d-%d-%d", &baseYear, &baseMonth, &baseDay);

      dateBase.tm_year = baseYear - 1900;
      dateBase.tm_mon = baseMonth - 1;
      dateBase.tm_mday = baseDay;
    }

    // æº€å¹´é½¢ã‚’è¨ˆç®—
    int age = calcAge(dateBirth, &dateBase);

    // ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
    struct tm timeAging = dateBirth;
    timeAging.tm_year += age;
    timeAging.tm_mday -= 1;
    timeAging.tm_hour = 24;

    // è¨ˆç®—åŸºæº–æ—¥ã¨ã®æ—¥æ•°å·®åˆ†ï¼ˆâ‰’çµŒéæ—¥æ•°ï¼‰ã‚’ç®—å‡º
    time_t date1 = mktime(&timeAging);
    time_t date2 = mktime(&dateBase);
    int days = absDiffTime(date1, date2);

    printf("å¹´é½¢ã¯ %d æ­³ã€çµŒéæ—¥æ•°ã¯ %d æ—¥ã§ã™\n", age, days);
  }
}



int main(){
  while(1){
    static int isContinue = 1;

    calcAgeAndDays();

    printf("ç¶šã‘ã¾ã™ã‹ï¼Ÿ 0 ã§çµ‚äº†ã—ã¾ã™ã€‚: ");
    scanf("%d", &isContinue);
    if(isContinue == 0) break;
  }
  return 0;
}
```

:::message alert

æš«å®šçš„ãªçŠ¶æ…‹ã§ã™ã€‚å¾Œã»ã©ã€é–¢æ•°ã¨æ¤œè¨¼ç”¨ã«åˆ‡ã‚Šåˆ†ã‘ã™ã‚‹äºˆå®šã§ã™ã€‚

:::

## ã¾ã¨ã‚

:::details JavaScriptã‚³ãƒ¼ãƒ‰

```javascript
/**
 * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰
 *
 * @param {date} dateBirth - ç”Ÿå¹´æœˆæ—¥
 * @param {date} dateBase - è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
 * @returns {int} - æº€å¹´é½¢
 */
function calcAge(dateBirth, dateBase = new Date()){
  // å‹ãƒã‚§ãƒƒã‚¯
  if(!(dateBirth instanceof Date && dateBase instanceof Date)) throw new Error('å¼•æ•°ã¯ Date å‹ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“');

  const age = dateBase.getFullYear() - dateBirth.getFullYear();

  // åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆè¨ˆç®—åŸºæº–å¹´ï¼‰ã¯ã€èª•ç”Ÿæ—¥ã®å‰æ—¥24æ™‚
  const timeBoundaryForAging = new Date(
    dateBase.getFullYear(),
    dateBirth.getMonth(),
    dateBirth.getDate() - 1,
    24
  );

  // æº€å¹´é½¢ã¯ã€åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ ã¾ã è¶Šãˆã¦ã„ãªã„å ´åˆã€ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦è¿”ã™
  if(timeBoundaryForAging > dateBase){
    return age - 1;
  } else {
    return age;
  }
}



/**
 * ï¼’ã¤ã®æ—¥ä»˜é–“ã«ã‚ã‚‹æ—¥æ•°ï¼ˆçµ¶å¯¾å€¤ï¼‰ã‚’ç®—å‡º
 *
 * @param {date} date1 - æ—¥ä»˜ï¼‘
 * @param {date} date2 - æ—¥ä»˜ï¼’
 * @returns {int} æœŸé–“å†…ã®æ—¥æ•°ï¼ˆä½™å‰°ã®æ™‚é–“ã¯åˆ‡ã‚Šæ¨ã¦ï¼‰
 */
function dateDiff(date1, date2) {
  // å‹ãƒã‚§ãƒƒã‚¯
  if(!(date1 instanceof Date && date2 instanceof Date)) throw new Error('å¼•æ•°ã¯ Date å‹ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“');

  // ãƒŸãƒªç§’å˜ä½ã§ã®æœŸé–“ã‚’æ±‚ã‚ã€æ—¥æ•°å˜ä½ã«ã—ã¦è¿”ã™
  const ms = Math.abs(date1.getTime() - date2.getTime());
  return Math.floor(ms / (1000 * 60 * 60 * 24));
}



/**
 * å¹´æœˆæ—¥ã‚’è¡¨ã™æ–‡å­—åˆ—ãŒã€é©æ­£ã‹ã‚’åˆ¤æ–­
 *
 * @param {string} dateString - 'yyyy-MM-dd' å½¢å¼ã®æ–‡å­—åˆ—
 * @returns {boolean} å­˜åœ¨ã—ã†ã‚‹æ—¥ä»˜ã‹ã®åˆ¤å®š
 */
function isDateFormat(dateString) {
  // æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆyyyy-MM-ddï¼‰
  const dateFormatRegex = /^\d{4}-\d{2}-\d{2}$/
  if (!dateString.match(dateFormatRegex)) return false;

  // ç°¡æ˜“çš„ãªæœˆæ—¥ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæœˆã®ç¯„å›²ã¯1ã€œ12ã‹ã€æ—¥ã®ç¯„å›²ã¯1ã€œ31ã‹ï¼‰
  const [year, month, day] = dateString.split('-').map(Number);
  if(
    !(month >= 1 && month <= 12) ||
    !(day >= 1 && day <= 31)
  ) return false;

  // date å‹ã«ã‚ˆã‚‹å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆå…¥åŠ›å€¤ãŒ `2/31` ã¨ã„ã£ãŸå­˜åœ¨ã—ãªã„æ—¥ä»˜ã ã£ãŸã‚Šã€é–æ—¥ã«ã‚ˆã‚Šå®Ÿéš›ã®æ—¥ä»˜ã¨ã‚ºãƒ¬ã¦ãªã„ã‹ï¼‰
  const date = new Date(year, month - 1, day);
  if (
    date.getFullYear() !== year ||
    date.getMonth() + 1 !== month ||
    date.getDate() !== day
  ) return false;

  return true;
}



/**
 * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’è¨ˆç®—
 *
 * @param {string} textBirth - ç”Ÿå¹´æœˆæ—¥ï¼ˆyyyy-MM-ddå½¢å¼ï¼‰
 * @param {date} dateBase - è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
 */
function calcAgeAndDays(textBitrh, dateBase = new Date()){
  if(isDateFormat(textBitrh)) {
    const [year, month, day] = textBitrh.split('-').map(Number);
    const dateBirth = new Date(year, month - 1, day);

    const age = calcAge(dateBirth, dateBase);

    // ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
    const timeAging = new Date(
      dateBirth.getFullYear() + age,
      dateBirth.getMonth(),
      dateBirth.getDate() - 1,
      24
    );

    const days = dateDiff(timeAging, dateBase);

    console.log(`å¹´é½¢ã¯ ${age} æ­³ã€çµŒéæ—¥æ•°ã¯ ${days} æ—¥ã§ã™`);
  }
}
```

:::

:::details VBAã‚³ãƒ¼ãƒ‰

```vba
' ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰
'
' å¼•æ•° dateBirth As Date - ç”Ÿå¹´æœˆæ—¥
' å¼•æ•° (Optional) dateBase As Date - è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
' è¿”ã‚Šå€¤ Integer - æº€å¹´é½¢
'
Function CalcAge(dateBirth As Date, Optional dateBase As Date = 0) As Integer
  ' å¼•æ•°ãƒã‚§ãƒƒã‚¯
  If IsDate(dateBirth) = False Then
    Err.Raise vbObjectError + 1, , "å¼•æ•°ã¯Dateå‹ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“"
  End If

  Dim dateCalc As Date
  If (IsDate(dateBase) = False) Or (dateBase = 0) Then
    dateCalc = Now
  Else
    dateCalc = dateBase
  End If

  Dim age As Integer
  age = Year(dateCalc) - Year(dateBirth)

  ' åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆè¨ˆç®—åŸºæº–å¹´ï¼‰ã¯ã€èª•ç”Ÿæ—¥ã®å‰æ—¥24æ™‚
  Dim timeBoundaryForAging As Date
  timeBoundaryForAging = DateSerial(Year(dateCalc), Month(dateBirth), Day(dateBirth) - 1) + TimeSerial(24, 0, 0)

  ' æº€å¹´é½¢ã¯ã€åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ ã¾ã è¶Šãˆã¦ã„ãªã„å ´åˆã€ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦è¿”ã™
  If timeBoundaryForAging > dateCalc Then
    CalcAge = age - 1
  Else
    CalcAge = age
  End If
End Function



' å¹´æœˆæ—¥ã‚’è¡¨ã™æ–‡å­—åˆ—ãŒã€é©æ­£ã‹ã‚’åˆ¤æ–­
'
' å¼•æ•° dateString As String - 'yyyy-MM-dd' å½¢å¼ã®æ–‡å­—åˆ—
' è¿”ã‚Šå€¤ Boolean - å­˜åœ¨ã—ã†ã‚‹æ—¥ä»˜ã‹ã®åˆ¤å®š
'
Function IsDateFormat(dateString As String) As Boolean

  ' æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆyyyy-MM-ddï¼‰
  Dim dateFormatRegex As Object
  Set dateFormatRegex = CreateObject("VBScript.RegExp")
  With dateFormatRegex
    .IgnoreCase = True
    .Global = False
    .Pattern = "^\d{4}-\d{2}-\d{2}$"
  End With

  If Not dateFormatRegex.test(dateString) Then
    IsDateFormat = False
    Exit Function
  End If

  ' ç°¡æ˜“çš„ãªæœˆæ—¥ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæœˆã®ç¯„å›²ã¯1ï½12ã‹ã€æ—¥ã®ç¯„å›²ã¯1ï½31ã‹ï¼‰
  Dim numYear As Integer
  Dim numMonth As Integer
  Dim numDay As Integer
  numYear = CInt(Split(dateString, "-")(0))
  numMonth = CInt(Split(dateString, "-")(1))
  numDay = CInt(Split(dateString, "-")(2))

  If (numMonth < 1) Or (numMonth > 12) Or (numDay < 1) Or (numDay > 31) Then
    IsDateFormat = False
    Exit Function
  End If

' dateå‹ã«ã‚ˆã‚‹å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆå…¥åŠ›å€¤ãŒ `2/31` ã¨ã„ã£ãŸå­˜åœ¨ã—ãªã„æ—¥ä»˜ã ã£ãŸã‚Šã€é–æ—¥ã«ã‚ˆã‚Šå®Ÿéš›ã®æ—¥ä»˜ã¨ã‚ºãƒ¬ã¦ãªã„ã‹ï¼‰
  Dim dateCheck As Date
  dateCheck = DateSerial(numYear, numMonth, numDay)
  If (Year(dateCheck) <> numYear) Or (Month(dateCheck) <> numMonth) Or (Day(dateCheck) <> numDay) Then
    IsDateFormat = False
    Exit Function
  End If

  IsDateFormat = True
End Function



' ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’è¨ˆç®—
'
' å¼•æ•° textBirth As String - ç”Ÿå¹´æœˆæ—¥ï¼ˆyyyy-MM-ddå½¢å¼ï¼‰
' å¼•æ•° (Optional) dateBase As Date - è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
'
Function CalcAgeAndDays(textBirth As String, Optional dateBase As Date = 0)
  Dim dateCalc As Date
  If (IsDate(dateBase) = False) Or (dateBase = 0) Then
    dateCalc = Now
  Else
    dateCalc = dateBase
  End If

  If (IsDateFormat(textBirth) = True) Then
    Dim dateBirth As Date
    dateBirth = DateSerial( _
      CInt(Split(textBirth, "-")(0)), _
      CInt(Split(textBirth, "-")(1)), _
      CInt(Split(textBirth, "-")(2)) _
    )
    
    Dim age As Integer
    age = CalcAge(dateBirth, dateCalc)
    
    ' ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
    Dim timeAging As Date
    timeAging = DateSerial( _
      Year(dateBirth) + age, _
      Month(dateBirth), _
      Day(dateBirth) - 1 _
    ) + TimeSerial(24, 0, 0)

    Dim days As Integer
    days = DateDiff("d", timeAging, dateCalc)  ' DateDiffã¯æ¨™æº–ã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹
    
    Debug.Print "å¹´é½¢ã¯ " & age & " æ­³ã€çµŒéæ—¥æ•°ã¯ " & days & " æ—¥ã§ã™"
  End If
End Function
```

:::

:::details PHPã‚³ãƒ¼ãƒ‰

```php
/**
 * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰
 *
 * @param DateTime $dateBirth ç”Ÿå¹´æœˆæ—¥
 * @param DateTime|null $dateBase è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
 * @return int æº€å¹´é½¢
 * @throws InvalidArgumentException å¼•æ•°ãŒ DateTime å‹ã§ãªã„å ´åˆ
 */
function calcAge(DateTime $dateBirth, DateTime $dateBase = null): int {
  // åŸºæº–æ—¥ã‚’ç¾åœ¨ã®æ—¥ä»˜ã«è¨­å®šï¼ˆå¼•æ•°ãŒçœç•¥ã•ã‚ŒãŸå ´åˆï¼‰
  $dateBase = $dateBase ?? new DateTime();

  // å‹ãƒã‚§ãƒƒã‚¯
  if (!($dateBirth instanceof DateTime) || !($dateBase instanceof DateTime)) {
    throw new InvalidArgumentException('å¼•æ•°ã¯ DateTime å‹ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“');
  }

  // å¹´é½¢è¨ˆç®—
  $age = $dateBase->format('Y') - $dateBirth->format('Y');

  // åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¨ˆç®—ï¼ˆèª•ç”Ÿæ—¥ã®å‰æ—¥24æ™‚ï¼‰
  $timeBoundaryForAging =  new DateTime();
  $timeBoundaryForAging -> setDate($dateBirth->format('Y') + $age, $dateBirth->format('m'), $dateBirth->format('d')) 
                        -> modify('-1 day')
                        -> setTime(24, 0, 0, 0);
  
  // æº€å¹´é½¢ã®èª¿æ•´
  if ($timeBoundaryForAging > $dateBase) {
    return $age - 1;
  } else {
    return $age;
  }
}


/**
 * å¹´æœˆæ—¥ã‚’è¡¨ã™æ–‡å­—åˆ—ãŒã€é©æ­£ã‹ã‚’åˆ¤æ–­
 *
 * @param string $date 'yyyy-MM-dd' å½¢å¼ã®æ–‡å­—åˆ—
 * @return bool å­˜åœ¨ã—ã†ã‚‹æ—¥ä»˜ã‹ã®åˆ¤å®š
 */
function isDateFormat(string $date): bool {
  if(!preg_match('/\A\d{4}-\d{2}-\d{2}\z/', $date)) return false;
  
  // å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæœˆæ—¥ã®ç°¡æ˜“çš„ãƒã‚§ãƒƒã‚¯ã‚’å«ã‚€ï¼‰
  list($year, $month, $day) = explode("-", $date);
  return checkdate((int)$month, (int)$day, (int)$year);
}


/**
 * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’è¨ˆç®—
 *
 * @param string $textBirth ç”Ÿå¹´æœˆæ—¥ï¼ˆyyyy-MM-ddå½¢å¼ï¼‰
 * @param DateTime|null $dateBase è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
 * @return void
 */
function calcAgeAndDays(string $textBirth, DateTime $dateBase = null){
  // åŸºæº–æ—¥ã‚’ç¾åœ¨ã®æ—¥ä»˜ã«è¨­å®šï¼ˆå¼•æ•°ãŒçœç•¥ã•ã‚ŒãŸå ´åˆï¼‰
  $dateBase = $dateBase ?? new DateTime();
  
  if(isDateFormat($textBirth)){
    $dateBirth =  new DateTime($textBirth);
    
    $age = calcAge($dateBirth, $dateBase);
    
    // ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
    $timeAging = new DateTime();
    $timeAging -> setDate($dateBirth->format('Y') + $age, $dateBirth->format('m'), $dateBirth->format('d')) 
               -> modify('-1 day')
               -> setTime(24, 0, 0, 0);

    $days = $timeAging -> diff($dateBase) -> days;
    echo "å¹´é½¢ã¯ $age æ­³ã€çµŒéæ—¥æ•°ã¯ $days æ—¥ã§ã™";
  }
}
```

:::

:::details Pythonã‚³ãƒ¼ãƒ‰

```python
import re
from datetime import date, datetime, time, timedelta


def generate_date(year: int, month: int, day: int):
  """
  å­˜åœ¨ã—ãªã„æ—¥ä»˜ã«å¯¾å¿œã™ã‚‹å½¢ã§ date ã‚’ä½œæˆã™ã‚‹

  Args:
    year (int): å¹´
    month (int): æœˆ
    day (int): æ—¥

  Returns:
    date: æ—¥ä»˜ï¼ˆé–æ—¥ãªã©ã‚’èª¿æ•´ã—ãŸå½¢ï¼‰
  """
  try:
    return date(year, month, day)
  except ValueError:
    # ç„¡åŠ¹ãªæ—¥ä»˜ã®å ´åˆã€èª¿æ•´ã™ã‚‹
    if day == 0:
      adjusted_date = date(year, month, 1) - timedelta(days=1)
    else:
      adjusted_date = date(year, month, 1) + timedelta(days=day - 1)
    return adjusted_date



def calc_age(date_birth: date, date_base: date = date.today()) -> int:
  """
  ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰

  Args:
    date_birth (date): ç”Ÿå¹´æœˆæ—¥
    date_base (date, optional): è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰

  Returns:
    int: æº€å¹´é½¢

  Raises:
    ValueError: å¼•æ•°ãŒ datetime å‹ã§ãªã„å ´åˆ
  """
  # å‹ãƒã‚§ãƒƒã‚¯
  if (not isinstance(date_birth, date)) or (not isinstance(date_base, date)):
    raise ValueError("å¼•æ•°ã¯ date å‹ã§æŒ‡å®šã—ã¦ãã ã•ã„")

  # å¹´é½¢è¨ˆç®—
  age = date_base.year - date_birth.year

  # åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆè¨ˆç®—åŸºæº–å¹´ï¼‰ã¯ã€èª•ç”Ÿæ—¥ã®å‰æ—¥24æ™‚
  time_boundary_for_aging = datetime.combine(generate_date(date_base.year, date_birth.month, date_birth.day -1), time(0, 0, 0)) + timedelta(hours = 24)

  # æº€å¹´é½¢ã¯ã€åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ã¾ã è¶Šãˆã¦ã„ãªã„å ´åˆã€ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦è¿”ã™
  if time_boundary_for_aging > datetime.combine(date_base, time(0, 0, 0)):
    return age - 1
  else:
    return age



def is_date_format(date_string: str) -> bool:
  """
  å¹´æœˆæ—¥ã‚’è¡¨ã™æ–‡å­—åˆ—ãŒã€é©æ­£ã‹ã‚’åˆ¤æ–­

  Args:
    date_string (str): 'yyyy-MM-dd' å½¢å¼ã®æ–‡å­—åˆ—

  Returns:
    bool: å­˜åœ¨ã—ã†ã‚‹æ—¥ä»˜ã‹ã®åˆ¤å®š
  """
  # æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆyyyy-MM-ddï¼‰
  date_format_regex = r"^\d{4}-\d{2}-\d{2}$"
  if not re.match(date_format_regex, date_string):
    return False

  # ç°¡æ˜“çš„ãªæœˆæ—¥ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæœˆã®ç¯„å›²ã¯1ã€œ12ã‹ã€æ—¥ã®ç¯„å›²ã¯1ã€œ31ã‹ï¼‰
  try:
    year, month, day = map(int, date_string.split('-'))
  except ValueError:
    return False

  if not ((1 <= month <= 12) and (1 <= day <= 31)):
    return False

  # æ—¥ä»˜ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
  date_check = generate_date(year, month, day)
  if(date_check.year != year or date_check.month != month or date_check.day != day):
    return False
  else:
    return True



def calc_age_and_days(text_birth: str, date_base: date = date.today()):
  """
  ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’ç®—å‡º

  Args:
    text_birth (str): ç”Ÿå¹´æœˆæ—¥ï¼ˆ'yyyy-MM-dd' å½¢å¼ï¼‰
    date_base (date, optional): è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
  """
  if(is_date_format(text_birth)):
    year, month, day = map(int, text_birth.split('-'))
    date_birth = generate_date(year, month, day)

    age = calc_age(date_birth, date_base)

    # ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’ èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
    time_aging = datetime.combine(generate_date(date_birth.year + age, date_birth.month, date_birth.day -1), time(0, 0, 0)) + timedelta(hours = 24)

    days = datetime.combine(date_base, time(0, 0, 0)) - time_aging
    print(f"{age}æ­³ã€{days.days}æ—¥çµŒé")
```

:::

:::details Javaã‚³ãƒ¼ãƒ‰

```java:AgeCalculator.java
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.temporal.ChronoUnit;
import java.time.format.DateTimeFormatter;
import java.time.format.ResolverStyle;
import java.util.Arrays;
import java.util.List;



public class AgeCalculator {

  /**
   * å­˜åœ¨ã—ãªã„æ—¥ä»˜å€¤ã‹ã‚‰ã‚‚å¯›å¤§ãªå½¢ã§ LocalDate ã‚’ç”Ÿæˆã™ã‚‹ï¼ˆä¾‹ï¼š1999-02-29 â†’ 1999-03-01ï¼‰
   * 
   * @param year å¹´
   * @param month æœˆ
   * @param day æ—¥
   * @return LocalDate èª¿æ•´ã•ã‚ŒãŸæ—¥ä»˜ãƒ‡ãƒ¼ã‚¿
   */
  public static LocalDate generateLocalDateWithLenient(int year, int month, int day) {
    DateTimeFormatter dtf = DateTimeFormatter.ISO_LOCAL_DATE.withResolverStyle(ResolverStyle.LENIENT);
    return LocalDate.parse(String.format("%04d-%02d-%02d", year, month, day), dtf);
  }



  /**
   * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰
   *
   * @param birthDate ç”Ÿå¹´æœˆæ—¥
   * @param baseDate  è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
   * @return int æº€å¹´é½¢
   */
  public static int calcAge(LocalDate birthDate, LocalDate baseDate){
    if (baseDate == null) baseDate = LocalDate.now();
    int age = baseDate.getYear() - birthDate.getYear();

    // åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆè¨ˆç®—åŸºæº–å¹´ï¼‰ã¯ã€èª•ç”Ÿæ—¥ã®å‰æ—¥24æ™‚
    LocalDateTime timeBoundaryForAging = generateLocalDateWithLenient(
      baseDate.getYear(), birthDate.getMonthValue(), birthDate.getDayOfMonth() - 1
    ).atTime(0, 0).plusHours(24);
    LocalDateTime baseDateTime = baseDate.atTime(0, 0);

    // æº€å¹´é½¢ã¯ã€åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ ã¾ã è¶Šãˆã¦ã„ãªã„å ´åˆã€ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¦è¿”ã™
    if (timeBoundaryForAging.isAfter(baseDateTime)) {
      return age - 1;
    } else {
      return age;
    }
  }



  /**
   * å¹´æœˆæ—¥ã‚’è¡¨ã™æ–‡å­—åˆ—ãŒã€é©æ­£ã‹ã‚’åˆ¤æ–­
   *
   * @param dateString 'yyyy-MM-dd' å½¢å¼ã®æ–‡å­—åˆ—
   * @return boolean å­˜åœ¨ã—ã†ã‚‹æ—¥ä»˜ã‹ã®åˆ¤å®š
   */
  public static boolean isDateFormat(String dateString){
    // æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆyyyy-MM-ddï¼‰
    String dateFormatRegex = "^\\d{4}-\\d{2}-\\d{2}$";
    if (!dateString.matches(dateFormatRegex)) return false;

    // ç°¡æ˜“çš„ãªæœˆæ—¥ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæœˆã®ç¯„å›²ã¯1ã€œ12ã‹ã€æ—¥ã®ç¯„å›²ã¯1ã€œ31ã‹ï¼‰
    String[] dateValues = dateString.split("-");
    int year = Integer.parseInt(dateValues[0]);
    int month = Integer.parseInt(dateValues[1]);
    int day = Integer.parseInt(dateValues[2]);
    if(month < 1 || month > 12 || day < 1 || day > 31) return false;

    // å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆå…¥åŠ›å€¤ãŒ `2/31` ã¨ã„ã£ãŸå­˜åœ¨ã—ãªã„æ—¥ä»˜ã ã£ãŸã‚Šã€é–æ—¥ã«ã‚ˆã‚Šå®Ÿéš›ã®æ—¥ä»˜ã¨ã‚ºãƒ¬ã¦ãªã„ã‹ï¼‰
    LocalDate dateCheck = generateLocalDateWithLenient(year, month, day);
    if (dateCheck.getYear() != year || dateCheck.getMonthValue() != month || dateCheck.getDayOfMonth() != day) return false;

    return true;
  }



  /**
   * ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰ã€æº€å¹´é½¢ã¨çµŒéæ—¥æ•°ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆæ™‚é–“åŸºæº–ï¼‰
   *
   * @param birthDate ç”Ÿå¹´æœˆæ—¥
   * @param baseDate  è¨ˆç®—åŸºæº–æ—¥ï¼ˆçœç•¥æ™‚ã¯ç¾åœ¨ã®æ—¥ä»˜ï¼‰
   * @return void
   */
  public static void calcAgeAndDays(String textBirth, LocalDate baseDate){
    if (baseDate == null) baseDate = LocalDate.now();

    if (isDateFormat(textBirth)) {
      LocalDate birthDate = LocalDate.parse(textBirth, DateTimeFormatter.ISO_LOCAL_DATE);

      int age = calcAge(birthDate, baseDate);

      // ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
      LocalDateTime timeAging = generateLocalDateWithLenient(
        birthDate.getYear() + age, birthDate.getMonthValue(), birthDate.getDayOfMonth() -1
      ).atTime(0,0).plusHours(24);
      LocalDateTime baseDateTime = baseDate.atTime(0, 0);

      // è¨ˆç®—åŸºæº–æ—¥ã¨ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°é–“ã®æ—¥æ•°ã‚’ç®—å‡º
      long days = ChronoUnit.DAYS.between(timeAging, baseDateTime);

      System.out.println("æº€å¹´é½¢: " + age + "çµŒéæ—¥æ•°: " + days);
    }
  }



  public static void main(String[] args) {
        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
        List<TestData> testCases = Arrays.asList(
            new TestData("1999-02-28", LocalDate.of(2023, 2, 28)),
            new TestData("1999-03-01", LocalDate.of(2023, 2, 28)),
            new TestData("2000-02-28", LocalDate.of(2023, 2, 28)),
            new TestData("2000-02-29", LocalDate.of(2023, 2, 28)),
            new TestData("2000-03-01", LocalDate.of(2023, 2, 28)),
            new TestData("1999-02-28", LocalDate.of(2023, 3, 1)),
            new TestData("1999-03-01", LocalDate.of(2023, 3, 1)),
            new TestData("2000-02-28", LocalDate.of(2023, 3, 1)),
            new TestData("2000-02-29", LocalDate.of(2023, 3, 1)),
            new TestData("2000-03-01", LocalDate.of(2023, 3, 1)),
            new TestData("1999-02-28", LocalDate.of(2024, 2, 28)),
            new TestData("1999-03-01", LocalDate.of(2024, 2, 28)),
            new TestData("2000-02-28", LocalDate.of(2024, 2, 28)),
            new TestData("2000-02-29", LocalDate.of(2024, 2, 28)),
            new TestData("2000-03-01", LocalDate.of(2024, 2, 28)),
            new TestData("1999-02-28", LocalDate.of(2024, 2, 29)),
            new TestData("1999-03-01", LocalDate.of(2024, 2, 29)),
            new TestData("2000-02-28", LocalDate.of(2024, 2, 29)),
            new TestData("2000-02-29", LocalDate.of(2024, 2, 29)),
            new TestData("2000-03-01", LocalDate.of(2024, 2, 29)),
            new TestData("1999-02-28", LocalDate.of(2024, 3, 1)),
            new TestData("1999-03-01", LocalDate.of(2024, 3, 1)),
            new TestData("2000-02-28", LocalDate.of(2024, 3, 1)),
            new TestData("2000-02-29", LocalDate.of(2024, 3, 1)),
            new TestData("2000-03-01", LocalDate.of(2024, 3, 1))
        );

        // ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
        for (TestData testCase : testCases) {
            String birthDate = testCase.birthDate;
            LocalDate referenceDate = testCase.referenceDate;

            // calcAgeAndDaysé–¢æ•°ã‚’å‘¼ã³å‡ºã—
            System.out.println("ç”Ÿå¹´æœˆæ—¥: " + birthDate + ", è¨ˆç®—åŸºæº–æ—¥: " + referenceDate);
            calcAgeAndDays(birthDate, referenceDate);
        }
  }
  // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä¿æŒç”¨ã‚¯ãƒ©ã‚¹
  static class TestData {
    String birthDate;
    LocalDate referenceDate;

    TestData(String birthDate, LocalDate referenceDate) {
      this.birthDate = birthDate;
      this.referenceDate = referenceDate;
    }
  }
}
```

:::

:::details Cã‚³ãƒ¼ãƒ‰

```c
#include <stdio.h>
#include <time.h>
#include <string.h>
#include <regex.h>
#include <stdlib.h>

// ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—å®£è¨€
void adjustDate(int *, int *, int *);
int calcAge(struct tm, struct tm *);
int absDiffTime(time_t, time_t);
int isDateFormat(char *);
void calcAgeAndDays(struct tm, struct tm *);
void testCalcAge(void);
void testIsDateFormat(void);
void testCalcAgeAndDays(void)

int main(){
  while(1){
    static int isContinue = 1;

    calcAgeAndDays();

    printf("ç¶šã‘ã¾ã™ã‹ï¼Ÿ 0 ã§çµ‚äº†ã—ã¾ã™ã€‚: ");
    scanf("%d", &isContinue);
    if(isContinue == 0) break;
  }
  return 0;
}



// æº€å¹´é½¢ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
int calcAge(struct tm dateBirth, struct tm *dateBase){
  // ç¾åœ¨ã®æ—¥ä»˜ã‚’å–å¾—ï¼ˆdateBaseãŒNullã®å ´åˆã¯ç¾åœ¨ã‚’ä½¿ç”¨ï¼‰
  time_t now = time(NULL);
  struct tm dateCalc = *localtime(&now);
  if(dateBase != NULL) dateCalc = *dateBase;

  // å¹´é½¢ã‚’è¨ˆç®—
  int age = dateCalc.tm_year - dateBirth.tm_year;

  // æº€å¹´é½¢æ™‚ã®å‰æ—¥24æ™‚ã‚’ç”Ÿæˆ
  struct tm timeBoundaryForAging = {0};
  timeBoundaryForAging.tm_year = dateCalc.tm_year;
  timeBoundaryForAging.tm_mon = dateBirth.tm_mon;
  timeBoundaryForAging.tm_mday = dateBirth.tm_mday -1;
  timeBoundaryForAging.tm_hour = 24;

  time_t boundaryTime = mktime(&timeBoundaryForAging);

  // æº€å¹´é½¢ã‚’èª¿æ•´
  if (difftime(boundaryTime, mktime(&dateCalc)) > 0) {
    return age - 1;
  } else {
    return age;
  }
};



void testCalcAge(void){
  // ç”Ÿå¹´æœˆæ—¥ã®å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã€é©æ­£ãªæ—¥ä»˜ã¨ã—ã¦èª¿æ•´
  char textBirth[11];
  int birthYear, birthMonth, birthDay;
  printf("ç”Ÿå¹´æœˆæ—¥ã‚’ 10 æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š2000-01-23ï¼‰: ");
  scanf("%s", textBirth);
  sscanf(textBirth, "%d-%d-%d", &birthYear, &birthMonth, &birthDay);

  struct tm dateBirth = {0};
  dateBirth.tm_year = birthYear - 1900;
  dateBirth.tm_mon = birthMonth - 1;
  dateBirth.tm_mday = birthDay;

  // è¨ˆç®—åŸºæº–æ—¥ã®å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã€é©æ­£ãªæ—¥ä»˜ã¨ã—ã¦èª¿æ•´
  char textBase[11];
  struct tm dateBase = {0};
  printf("è¨ˆç®—æ—¥ã‚’ 10 æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ0 å…¥åŠ›ã§ä»Šæ—¥ã«ã—ã¾ã™ï¼‰: ");
  scanf("%s", textBase);
  if(strcmp(textBase, "0") == 0){
    // ç¾åœ¨ã®æ—¥ä»˜ã‚’å–å¾—
    time_t now = time(NULL);
    dateBase = *localtime(&now);
  }else{
    // è¨ˆç®—åŸºæº–æ—¥ã‚’é©æ­£ãªæ—¥ä»˜ã¨ã—ã¦èª¿æ•´
    int baseYear, baseMonth, baseDay;
    sscanf(textBase, "%d-%d-%d", &baseYear, &baseMonth, &baseDay);

    dateBase.tm_year = baseYear - 1900;
    dateBase.tm_mon = baseMonth - 1;
    dateBase.tm_mday = baseDay;
  }

  // æº€å¹´é½¢ã‚’è¨ˆç®—
  int age = calcAge(dateBirth, &dateBase);
  printf("æº€å¹´é½¢: %d\n", age);
}



// é©æ­£ãªæ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã«èª¿æ•´ã™ã‚‹é–¢æ•°ï¼ˆä¾‹ï¼š2001/02/29 -> 2001/03/01ï¼‰
void adjustDate(int *year, int *month, int *day){
  struct tm date = {0};
  date.tm_year = *year - 1900;
  date.tm_mon = *month - 1;
  date.tm_mday = *day;

  // tm æ§‹é€ ä½“ã‚’ time_t ã«å¤‰æ›ï¼ˆé©æ­£ã§ãªã„å€¤ã¯ mktimeã€€é–¢æ•°å†…ã§èª¿ç¯€ï¼‰
  mktime(&date);

  *year = date.tm_year + 1900;
  *month = date.tm_mon + 1;
  *day = date.tm_mday;
}



// `yyyy-MM-dd` å½¢å¼ã®æ–‡å­—åˆ—ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°
int isDateFormat(char *text){
  int result = 1;

  // æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹åˆ¤å®š
  regex_t ptnBuf;
  const char regex[] = "^[0-9]{4}-[0-9]{2}-[0-9]{2}$";
  if(regcomp(&ptnBuf, regex, REG_EXTENDED | REG_NOSUB) == 0){
    int year, month, day;
    sscanf(text, "%d-%d-%d", &year, &month, &day);

    // å„å€¤ãŒé©æ­£ã‹ã©ã†ã‹ã‚’åˆ¤å®šï¼ˆæœˆæ•°ã€æ—¥æ•°ãŒç¾å®Ÿã®ç¯„å›²å†…ã‹ï¼‰
    if((month >= 1 && month <= 12) && (day >= 1 && day <= 31)){
      // å„å€¤ã®ã‚³ãƒ”ãƒ¼ã‚’ adjustDate é–¢æ•°ã«é€šã—ã€å¤‰åŒ–ã—ãªã„ã‹ã§åˆ¤å®š
      int yearCopy = year, monthCopy = month, dayCopy = day;
      adjustDate(&yearCopy, &monthCopy, &dayCopy);
      if(year == yearCopy && month == monthCopy && day == dayCopy){
        result = 0;
      }
    }
  }

  // é ˜åŸŸã‚’è§£æ”¾ã—ã€çµæœã‚’è¿”ã™
  regfree(&ptnBuf);
  return result;
}



void testIsDateFormat(void){
  char textTest[11];
  printf("ãƒ†ã‚¹ãƒˆã™ã‚‹æ—¥ä»˜ã‚’ 10 æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š2000-01-23ï¼‰: ");
  scanf("%s", textTest);
  char textResult[4];
  if(isDateFormat(textTest) == 0){
    strcpy(textResult, "OK");
  }else{
    strcpy(textResult, "NG");
  }
  // å…¥åŠ›å€¤ã¨çµæœã®è¡¨ç¤º
  printf("å…¥åŠ›å€¤: %s, çµæœ: %s\n", textTest, textResult);
}



// ï¼’ã¤ã®æ—¥ä»˜é–“ã«ã‚ã‚‹æ—¥æ•°ï¼ˆçµ¶å¯¾å€¤ï¼‰ã‚’ç®—å‡º
int absDiffTime(time_t time1, time_t time2){
  return abs((int)(difftime(time1, time2) / (60 * 60 * 24)));
}



void calcAgeAndDays(void){
  // ç”Ÿå¹´æœˆæ—¥ã®å…¥åŠ›
  char textBirth[11];
  printf("ç”Ÿå¹´æœˆæ—¥ã‚’ 10 æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š2000-01-23ï¼‰: ");
  scanf("%s", textBirth);

  // ç”Ÿå¹´æœˆæ—¥ã®å½¢å¼ãƒã‚§ãƒƒã‚¯
  if(isDateFormat(textBirth) != 0){
    printf("ç”Ÿå¹´æœˆæ—¥ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“\n");
    return;
  } else {
    // å…¥åŠ›å€¤ã‹ã‚‰ tm æ§‹é€ ä½“ã‚’ç”Ÿæˆ
    int birthYear, birthMonth, birthDay;
    sscanf(textBirth, "%d-%d-%d", &birthYear, &birthMonth, &birthDay);

    struct tm dateBirth = {0};
    dateBirth.tm_year = birthYear - 1900;
    dateBirth.tm_mon = birthMonth - 1;
    dateBirth.tm_mday = birthDay;

    // è¨ˆç®—åŸºæº–æ—¥ã®å…¥åŠ›
    char textBase[11];
    printf("è¨ˆç®—æ—¥ã‚’ 10 æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ0 å…¥åŠ›ã§ä»Šæ—¥ã«ã—ã¾ã™ï¼‰: ");
    scanf("%s", textBase);

    // å…¥åŠ›å€¤ã«å¿œã˜ãŸå‡¦ç†åˆ†å²
    struct tm dateBase = {0};
    if(strcmp(textBase, "0") == 0){
      // ç¾åœ¨ã®æ—¥ä»˜æƒ…å ±ã‚’ dateBase ã«ä»£å…¥
      time_t now = time(NULL);
      dateBase = *localtime(&now);
    } else if(isDateFormat(textBase) != 0){
      // é©æ­£ãªæ—¥ä»˜å½¢å¼ã§ãªã„ãŸã‚ã‚„ã‚Šç›´ã—
      printf("è¨ˆç®—æ—¥ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“\n");
      return;
    } else {
      // å…¥åŠ›å€¤ã‹ã‚‰ tm æ§‹é€ ä½“ã‚’ç”Ÿæˆ
      int baseYear, baseMonth, baseDay;
      sscanf(textBase, "%d-%d-%d", &baseYear, &baseMonth, &baseDay);

      dateBase.tm_year = baseYear - 1900;
      dateBase.tm_mon = baseMonth - 1;
      dateBase.tm_mday = baseDay;
    }

    // æº€å¹´é½¢ã‚’è¨ˆç®—
    int age = calcAge(dateBirth, &dateBase);

    // ç¾å¹´é½¢ã®åŠ é½¢ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆâ‰’èª•ç”Ÿæ—¥å‰æ—¥24æ™‚ï¼‰
    struct tm timeAging = dateBirth;
    timeAging.tm_year += age;
    timeAging.tm_mday -= 1;
    timeAging.tm_hour = 24;

    // è¨ˆç®—åŸºæº–æ—¥ã¨ã®æ—¥æ•°å·®åˆ†ï¼ˆâ‰’çµŒéæ—¥æ•°ï¼‰ã‚’ç®—å‡º
    time_t date1 = mktime(&timeAging);
    time_t date2 = mktime(&dateBase);
    int days = absDiffTime(date1, date2);

    printf("å¹´é½¢ã¯ %d æ­³ã€çµŒéæ—¥æ•°ã¯ %d æ—¥ã§ã™\n", age, days);
  }
}
```

:::
