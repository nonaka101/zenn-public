---
title: "📄B001：構成について(2)"
---

## このページについて

前項では、WordPress の仕組みについて説明しました。

今回はテンプレートパーツの話を加え、そこから静的サイトのファイル構成を説明していきます。

## WordPressテーマ化を見据えた構成

### 前回のおさらい

WordPressはCMSの一種であり、様々な情報はSQLによるデータベースで管理されています。閲覧者がページを閲覧するときには、該当する情報をDB上から取得し、内容に応じたページテンプレートに情報を適用することで ページとして出力する、という流れでした。

![閲覧者が特定ページの閲覧を要求、DBから記事情報を取得し、ページテンプレートへ当てはめHTMLファイルを生成し、送り返す流れ](/images/books/web-zukuri/flow-create-page-01.png)
*閲覧要求からページ表示されるまでの大まかな流れ*

ページテンプレートは、最低限の構成としては `index.php` １つで済みます。ですが本テーマではテンプレートヒエラルキーに従い、ページ種類に応じた下記のページテンプレートを用意することにしました。

- トップページ：`front-page.php`
- 固定ページ：`page.php`（※）
- 投稿ページ：`single.php`（※）
- アーカイブページ：`archive.php`
- 検索ページ：`search.php`
- 404ページ：`404.php`
- その他の汎用ページ：`index.php`

（※固定/投稿ページは最終的には `singular.php` に統合しますが、ここでは説明の都合上そのままにします）

### テンプレートパーツについて

![フロントページで使われているテンプレートパーツのイメージ図。ヘッダー、サイドバーが空欄になっており、そこへ1行のコードで別ファイルからコードを呼び出している](/images/books/web-zukuri/about-template-parts-01.png)
*フロントページ（`front-page.php`）は、複数のテンプレートパーツで構成されている*

ページテンプレートで ページ種類に応じたテンプレートを用意することは、１ファイル内であらゆる状況に対応する場合と比較して、コード量と複雑性を抑える効果があります。

しかし複数のファイルを扱うデメリットとして、例えば修正/変更ミスが考えられます。例えば 30行近くで構成されたヘッダーを各ページテンプレートにコピペして運用しているとして、そこに修正が発生した場合を考えてみましょう。全てのページテンプレートでコピペをやり直す必要があり手間ですし、また修正漏れも起きそうです。

これを解決してくれるのが**テンプレートパーツ**です。これは**各ページ間で共通する部品をテンプレート化**する機能です。テンプレート化したものは独立した状態となり、何十行とある部品でも１行の関数で呼び出すことができます。

下図はテンプレートパーツのイメージで、右サイドバーをテンプレートパーツ化しています。これにより右サイドバーを単純な関数呼び出しで実装することができました。また、右サイドバーに修正が発生したとしても、テンプレートパーツ側を変更することで対処できます。右サイドバーを関数で呼び出している全てのページが、この修正されたテンプレートパーツを参照するからです。

![フロントページに右サイドバーを読み込むコードを埋め込むことで、別ファイルで用意したコードを1行で呼び出せる](/images/books/web-zukuri/about-template-parts-02.png)

:::message

似た言葉ですが、**ページ**テンプレートは*各種ページのテンプレート*で、テンプレート**パーツ**は*ページ内で使われる部品テンプレート*です。違うものということにご注意ください。

:::

### 本テーマで使用するテンプレートパーツ

ここでは、本テーマで使用しているテンプレートパーツを見ていきます。

:::message alert

ここでは WordPress の機能に突っ込んだ話をしている関係上、初めての方には難しい内容となっております。

ここで話している内容は、第三章で再度詳しく解説することになるので、完璧に理解する必要はありません。「いろんなページで使われる要素や、プログラムで制御する必要性が強い要素をテンプレートパーツとして独立させて扱っているんだ」ということだけ掴み取れればOKです。

:::

#### ページ間で同じ構成のもの

最初に大枠となるテンプレートパーツ群です。これらは基本的に全てのページテンプレート上に存在しうるものです。WordPressでは専用のファイル名と関数を使うことができます。

- ヘッダー：`header.php`
- フッター：`footer.php`
- 左サイドバー：`sidebar-left.php`
- 右サイドバー：`sidebar-right.php`

それとは別に、テーマ独自のものも存在します。下記の「開発ツール」は、**B200：開発ツール**で取り上げているものです。これはページの「カラーモード」や「可変フォントサイズ」を検証しやすくするために用意したもので、全てのページで使われます（WordPress 上ではカスタマイザーで出力のオン/オフを切り替えられます。）

- 開発ツール：`parts-devutils`

#### 特殊なもの

次に上記に当てはまらない、少し特殊なものになります。

まずは検索ページのテンプレート `search.php` と関連付けられる テンプレートパーツ `searchform.php` です。これはHTMLの `form` 要素で構成され、検索フォームの部分を部品化したものです。

![bl_searchFormのスクリーンショット、これがWordPressではsearchform.phpを担う](/images/books/web-zukuri/bl_searchForm-01.png)

:::message

WordPress で想定されている使い方と、本テーマでの扱いは少し異なっています。

本来の `searchform.php` は、ヘッダーなどに簡易的な検索フォームとしてつけるのが主流です（なので、どのページからでもサイト内検索が行えます）。ここから検索を実行すると、フォーム内の要素を使ってクエリが実行され、その結果を `search.php` で表示するのが、主な動きになります。

本テーマではそうはなっておらず、検索用のページを独立して用意している形になっています。そのため `searchform.php` は `search.php` 内でのみ使われており、検索を実行すると再度 `search.php` を呼び出す処理になっています（`search.php` へは擬似的なフォーム情報を裏で用意し、リンク要素として使っています）

このようにした理由は、当時のデジタル庁のサイトに合わせたためです。あちら側では検索用のページが独立して用意されていたので、本テーマでもそれに合わせています。なので「こうでなければならない」といった強い理由ではありません。

:::

次に、`functions.php` と連携して機能させるパーツ群です。主にループ処理を使って、特定の形式で出力するようなもの達にあたります。

- メニュー項目の出力：`parts-menu.php`
- ページ区切りの出力：`parts-pagenation.php`
- カード形式での記事出力：`loop-post.php`

`parts-menu.php` はメニュー項目を出力するためのものです。`sidebar-left.php`, `sidebar-right.php`, `header.php`, `footer.php` などのテンプレートパーツ内にも使われています。テンプレートパーツはこのように、更に細分化してパーツ化することが可能です。

![タグメニュー、WordPressのメニュー管理画面と連携していることを示している](/images/books/web-zukuri/bl_tagMenu-03.png)

WordPress はメニュー項目をカスタマイズすることができます。これは、指定したメニュー情報を拾い要素へと出力できるようにテンプレートパーツ化しています。

`parts-pagenation.php` はページ区切りを出力するためのものです。この要素はアーカイブページと検索ページに用いられます。

![ページネーション要素の例。アーカイブページのフッター手前の位置に配置され、ページを切り替える役割を持っている](/images/books/web-zukuri/page-archive-02.png)
*例：[アーカイブページ](https://nonaka101.github.io/web-zukuri/archive.html)のページネーション要素*

![ページネーション要素の基本的な構造（総ページ数15に対し、現在位置は7の場合）](/images/books/web-zukuri/bl_pager-01.png)
*`parts-pagenation.php`要素*

これは１ページ内に表示する件数や、（検索キーワードや、カテゴリ・タグなどの）条件に合致する件数によって変化する要素です。例えばヒットする件数が少なければ、下図のようになるでしょう。

![ページ総数が少ない場合の構造（総ページ数2に対し、現在位置は2の場合）](/images/books/web-zukuri/bl_pager-05.png)
*現在のページ位置や、総ページ数に合わせて出力要素は調整される*

そのため、取得する記事群の状態に合わせて内容を調整できるよう、テンプレートパーツ化しています。

最後の `loop-post.php` もページネーション同様、取得する記事群に合わせて出力を調整するためにテンプレートパーツ化したものになります。これは各所で用いられているカード形式にデータを当てはめるためのものです。

![記事データから矢印を伸ばし、各種カードに繋がるような画像（フッター、フロントサムネイル付き、アーカイブ）](/images/books/web-zukuri/about-template-parts-03.png)

## 構成について

ここまでで、WordPress の仕組みについて話をしてきました。そこでは下記のような特徴がありました。

1. ページの種類に合わせて、ページテンプレートを用意する
2. ページ間で共通する部品や、プログラムによる制御が必要な要素は、テンプレートパーツとして独立させる

テーマを作る際には、これらの WordPress の仕組みを考慮して作成する必要があります。

まずは１番の内容から、WordPress でページテンプレートを作る用に静的ページを作ります。構成としては下図のようになります。

```text
.
├── .nojekyll [※GitHub Pages用]
├── index.html
├── page.html
├── single.html
├── archive.html
├── search.html
├── 404.html
└── assets/
        ├── css/
        │      ├── style.css
        │      ├── normalize.css
        │      └── devUtilities.css
        ├── js/
        │      ├── common.js
        │      └── devUtilities.js
        └── image/
                ├── dummy_logo.png
                └── m_02_white.png
```

そのうえで２番の内容を考慮し、他ページでも使い回せるような構成を心がけていくことになります。

### index.html

ここではトップページを作成します。

![index.htmlの見本](/images/books/web-zukuri/page-index-01.png)

このページの特徴は、下記となります。

- 左サイドバーが存在
- そのため、他ページと 12グリッドの使い方が異なる（左サイドバー: 3, コンテンツ: 6, 右サイドバー: 3）
- コンテンツ部はカードコンポーネントを使い、最新の記事や、上部固定に設定した記事を表示

:::message
実際には、ここで作成した内容は `front-page.php` となります。

最初から `front-page.html` としないのは、GitHub Pages の関係です。GitHub Pages では [`/doc` 内の `index.html` をエントリファイルにする](https://docs.github.com/ja/pages/getting-started-with-github-pages/creating-a-github-pages-site#creating-your-site)ため、トップページを `index.html` とする必要があります。
:::

### page.html

ここでは、固定ページを作成します。

![page.htmlの見本](/images/books/web-zukuri/page-page-01.png)

このページの特徴は、下記となります。

- 12グリッドの使い方は、コンテンツが9、右サイドバーは3

### single.html

ここでは、投稿ページを作成します。

![single.htmlの見本](/images/books/web-zukuri/page-single-01.png)

このページの特徴は、下記となります。

- page.htmlがベース
- 記事のサムネイル画像を表示
- 「投稿日」「カテゴリ」「タグ」といった投稿データを表示
- （上記を飛ばし）記事本文へ移動できるブロックスキップを用意

:::message

実際には、固定ページと投稿ページは まとめて `singular.php` として作成します。

見た目の確認のため、ベース段階では2つを分けて作成します。
:::

### archive.html

ここでは、アーカイブページを作成します。

![archive.htmlの見本](/images/books/web-zukuri/page-archive-01.png)

![archive.htmlの下部](/images/books/web-zukuri/page-archive-02.png)

このページの特徴は、下記となります。

- 年月、カテゴリ、タグなどのアーカイブをまとめて管理
- そのアーカイブの記事郡を、カード形式で表示
- 記事が大量にある場合にはページを区切り、ページネーション要素を用いる

### search.html

ここでは、検索ページを作成します。

![search.htmlの見本](/images/books/web-zukuri/page-search-01.png)

![search.htmlの下部](/images/books/web-zukuri/page-archive-02.png)

このページの特徴は、下記となります。

- 上部に検索フォーム、下部にヒットした記事をカード形式で表示
- 検索フォームは、「検索件数」「検索キーワード」「検索ボタン」の3つで構成
- ヒットした件数が多い場合はページを区切り、ページネーション要素を用いる

### 404.html

ここでは、404ページを作成します。

![404.htmlの見本](/images/books/web-zukuri/page-404-01.png)

このページの特徴は、下記となります。

- 内容が見つからない旨と、トップページへ戻るためのリンクを表示

### assets フォルダ

ここからは、assetsフォルダ内のファイル郡となります。  
ここでは、画像、css、Javascript関係のファイルを扱うことになります。

#### assets/css/style.css

ここでは、全体に関するスタイルを規定します。

#### assets/css/normalize.css

このテーマではノーマライズCSSを使用します。  
※詳しくは後述の「[外部から適用するものについて](#外部から適用するものについて)」を参照

#### assets/css/devUtilities.css

ここでは、開発用のツールに関するスタイルを規定します。  
本来のテーマには不要なものなので、後々適用から外せるよう別ファイルにしています。

#### assets/js/common.js

全体に関するJavascriptデータとなります。

#### assets/js/devUtilities.js

ここでは、開発用のツールに関するスクリプトをまとめています。  
本来のテーマには不要なものなので、後々適用から外せるよう別ファイルにしています。

#### assets/image/dummy_logo.png

ダミーのロゴです。

#### assets/image/m_02_white.png

サムネイル用のサンプル画像データです。  
こちらの画像は、デジタル庁が公開しているイラストレーションになります。

https://www.digital.go.jp/policies/servicedesign/designsystem/Illustration_Icons

## 外部から適用するものについて

### normalize.css

本テーマでは、スタイルのノーマライズに下記を利用しています。

https://necolas.github.io/normalize.css/

### Googleフォント

本テーマでは、デザインシステムに合わせGoogleフォントを使用しています。

## まとめ

本項では２回に渡り、静的サイトの構成を考えてきました。WordPress の仕組みから、テーマ化することを前提にどのような構成にしていけばいいかを考えました。

次項からは ここで決めた内容を基に、実際に静的ページを作成していくことになります。
