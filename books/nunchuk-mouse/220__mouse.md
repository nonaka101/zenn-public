---
title: "📄設計：マウスについて"
---

## はじめに

本項では、一般的なマウスの機能を定義し、本リポジトリで実装すべき機能について考察します。

:::message

なお、本リポジトリで扱うマウスは **5 ボタンマウス**（通常の 3 ボタンマウスに「戻る」「進む」ボタンが追加されたもの）を想定しています。

:::

## 機能としてのマウス

ここでは、マウスが果たす機能（役割）について考えていきます。

### マウスボタン

**左右中**、計 3 つのボタンを扱えるようする必要があります。

またこれらのボタンは、クリック、ダブルクリック、ドラッグといった操作が行えるよう、**押下/解放状態をユーザーが自在にコントロールできる**必要があります。

:::message

実際の処理では、コントローラーの入力内容読み取りは高速（秒間数十回）で行われます。

**押下/解放状態の管理**とは、その都度「このボタンは押した」「このボタンは離した」といった処理を行うものではありません。直近までの状態と現在を比べ、**状態の変化を管理**する必要があります。

:::

### カーソル移動

**2 軸**（`x, y`）方向に対し、カーソル移動ができる必要があります。

上下左右だけでなく**斜めに移動**できることが求められ、また「**カーソルを動かさない**」という動作が容易でなければなりません。

:::message

リポジトリでは「カーソルを動かさない（という操作）」という観点から、加速度情報をカーソル移動に使うのは適さないと判断しています。

例えば 加速度情報とカーソルを単純に連動させた場合、デバイスの傾けでカーソル移動を行うことになります。一見すると直感的な操作ができそうですが、一方でカーソル移動を止めるには**同じ姿勢を保持し続けなければならず、操作性としては扱いづらい**です。この問題は、[後述](./230__problems-with-combining)にて再度取り上げます。

:::

### ホイール移動

**1 軸**方向に対し、ホイール移動（スクロール）できる必要があります。

### 戻る、進む機能

ブラウザやエクスプローラーなどの画面上で「戻る」「進む」操作を行える必要があります。

ボタンを押し続けて過剰反応[^2]すると扱いづらいため、ボタンとして組み込む場合には、**一度機能が働くと 一定期間反応しない**ようする必要があります。

[^2]: コントローラー情報の読み取りは 1 秒間に何十回と行われるので、その速度で機能が働いてしまうと、1度の押下で数回分の処理が行われてしまいます。これはユーザーの想定からは外れており、扱いづらい要因となります。

## 実装するためのライブラリ

5 ボタンマウスの実装のため、リポジトリでは `Mouse`, `Keyaboard` ライブラリを使用します。

ここではリポジトリ内で扱うライブラリの機能について簡単に解説します。詳細については下記サイトを参照してください。

https://docs.arduino.cc/language-reference/en/functions/usb/Mouse/

https://docs.arduino.cc/language-reference/en/functions/usb/Keyboard/

### `Mouse` ライブラリ

一般的な 3 ボタンマウスに関しては、この `Mouse` ライブラリで実装可能です。

#### `Mouse.begin()`

Mouse ライブラリを初期化し、機能を使えるようにします。

:::message

`Mouse.end()` で終了させることもできますが、リポジトリでは使用していません。

:::

#### `Mouse.move(カーソルX, カーソルY, ホイール)`

カーソル及びホイール移動を行います。

|種類＼入力値|負の数値|正の数値|
|---|---|---|
|**カーソルX**|左方向へ移動|右方向へ移動|
|**カーソルY**|下方向に移動|上方向に移動|
|**ホイール**|下方向にスクロール|上方向にスクロール|

#### `Mouse.press(ボタン)`

特定のボタンを押下状態にします。ボタンは下記の 3 種類が指定可能です。

- `MOUSE_LEFT`（マウス左ボタン）
- `MOUSE_RIGHT`（マウス右ボタン）
- `MOUSE_MIDDLE`（マウス中ボタン）

:::message

`press()` と `release()` 機能がセットとなる `Mouse.click(ボタン)` がありますが、リポジトリでは使用していません。

:::

#### `Mouse.release(ボタン)`

特定のボタンを解放状態にします。ボタン指定は `Mouse.press()` で使う 3 種が可能です。

### `Keyboard` ライブラリ

キーボードを扱う場合に、このライブラリを使用します。

リポジトリでは、5 ボタンマウスで必要となる「戻る」「進む」機能を**ショートカットキーで実装する**関係で使用しています。

#### `Keyboard.begin()`

Keyboard ライブラリを初期化し、機能を使えるようにします。

:::message

`Keyboard.end()` で終了させることもできますが、リポジトリでは使用していません。

:::

#### `Keyboard.press(キー)`

特定のキーを押下状態にします。修飾キーや特殊キーなどは、数値による指定だけでなく[公式ドキュメント](https://docs.arduino.cc/language-reference/en/functions/usb/Keyboard/keyboardModifiers/)に掲載されている文字列を使うことでも可能です。

:::message

`press()` と `release()` 機能がセットとなる `Keyboard.write(キー)` がありますが、リポジトリでは（単一のキー操作を扱わないため）使用していません。

また連続した文字列を入力できる `Keyboard.print(テキスト)` 等も使用していません。

:::

#### `Keyboard.releaseAll()`

押下状態にあるキーを全て解放します。

:::message

個別にキー入力を解放したい場合は、`Keyboard.release(キー)` を使用する方法もあります。

:::

## まとめ

本項では、一般的な 5 ボタンマウスの機能を定義し、本リポジトリで実装すべき機能について考えました。

また Arduino では `Mouse`, `Keyboard` ライブラリが用意されているので、それらを使うことで実装できそうなことも確認しました。

次項では、ここまでで解説したコントローラとマウスを組み合わせた際に生じる問題点について、考えていきます。
